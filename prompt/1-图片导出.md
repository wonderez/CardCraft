### ç”¨æˆ·:
é¡¹ç›®èƒŒæ™¯
æˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ª Windows æ¡Œé¢åº”ç”¨ã€ŒCardCraftã€ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ï¼š
- ç”¨æˆ·è¾“å…¥ Markdown æ–‡æœ¬
- è‡ªåŠ¨æ¸²æŸ“æˆå°çº¢ä¹¦é£æ ¼çš„ç²¾ç¾å¡ç‰‡
- æ™ºèƒ½åˆ†é¡µï¼ˆ3:4 æ¯”ä¾‹ï¼Œ1080Ã—1440pxï¼‰
- æ‰¹é‡å¯¼å‡ºé«˜è´¨é‡å›¾ç‰‡
Â 
# æŠ€æœ¯æ ˆ
- æ¡†æ¶ï¼šPySide6 (Qt for Python)
- æ¸²æŸ“ï¼šQWebEngineView (åŸºäº Chromium)
- Markdownè§£æï¼špython-markdown + æ‰©å±•
- æ ·å¼ï¼šHTML + CSS (å°çº¢ä¹¦é£æ ¼)
- åˆ†é¡µï¼šJavaScript (åœ¨ WebEngine ä¸­æ‰§è¡Œ)
Â 
# æ ¸å¿ƒæ¶æ„è®¾è®¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â Â Â Â Â Â Â Â Â Â ä¸»çª—å£ (MainWindow) Â Â Â Â Â Â Â Â Â Â â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Â ç¼–è¾‘å™¨ç»„ä»¶ Â â”‚ Â Â é¢„è§ˆç»„ä»¶ Â Â Â â”‚ Â å·¥å…·æ  Â Â â”‚
â”‚ (QTextEdit) â”‚(QWebEngineView)â”‚ (QToolBar)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Markdownè§£æ Â â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â HTMLç”Ÿæˆ Â Â Â â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â æ™ºèƒ½åˆ†é¡µ Â Â Â â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â æ ·å¼æ¸²æŸ“ Â Â Â â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â å›¾ç‰‡å¯¼å‡º Â Â Â â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Â 
# é¡¹ç›®ç»“æ„
cardcraft/
â”œâ”€â”€ main.py Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â # å¯åŠ¨ç¨‹åºï¼Œåˆ›å»º Qt åº”ç”¨
â”œâ”€â”€ requirements.txt Â Â Â Â Â Â Â Â Â Â Â # ä¾èµ–åŒ…åˆ—è¡¨ï¼šPySide6ã€markdown ç­‰
Â 
src/
â”œâ”€â”€ ui/
â”‚ Â Â â”œâ”€â”€ main_window.py Â Â Â Â Â Â Â Â # ä¸»çª—å£ï¼šå·¦å³åˆ†æ å¸ƒå±€ï¼Œå¯¼å‡ºæŒ‰é’®ï¼Œ300mså»¶è¿Ÿæ›´æ–°
â”‚ Â Â â”œâ”€â”€ editor_widget.py Â Â Â Â Â Â # å·¦ä¾§ç¼–è¾‘å™¨ï¼šQTextEditï¼Œå«ç¤ºä¾‹æ–‡æœ¬
â”‚ Â Â â”œâ”€â”€ preview_widget.py Â Â Â Â Â # å³ä¾§é¢„è§ˆï¼šQWebEngineView æ˜¾ç¤º HTML
â”‚ Â Â 
â”œâ”€â”€ core/
â”‚ Â Â â”œâ”€â”€ markdown_processor.py Â # Markdown è½¬ HTMLï¼šä½¿ç”¨ python-markdown åº“
â”‚ Â Â â”œâ”€â”€ html_generator.py Â Â Â Â Â # ç”Ÿæˆå®Œæ•´ç½‘é¡µï¼šæ·»åŠ  CSS æ ·å¼ï¼ˆç´«è‰²æ¸å˜èƒŒæ™¯ï¼‰
â”‚ Â Â 
â”œâ”€â”€ utils/
â”‚ Â Â â”œâ”€â”€ paginator.py Â Â Â Â Â Â Â Â Â Â # ï¿½ï¿½ ç©ºæ–‡ä»¶ï¼ˆæœªå®ç°ï¼‰
â”‚ Â Â â”œâ”€â”€ exporter.py Â Â Â Â Â Â Â Â Â Â Â # ï¿½ï¿½ ç©ºæ–‡ä»¶ï¼ˆæœªå®ç°ï¼Œå¯¼å‡ºåŠŸèƒ½åœ¨ preview_widget ä¸­ï¼‰
â”‚ Â Â 
â”œâ”€â”€ resources/
â”‚ Â Â â”œâ”€â”€ styles/ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â # ï¿½ï¿½ ç©ºæ–‡ä»¶å¤¹ï¼ˆCSS ç›´æ¥å†™åœ¨ html_generator.py ä¸­ï¼‰
â”‚ Â Â â””â”€â”€ templates/ Â Â Â Â Â Â Â Â Â Â Â Â # ï¿½ï¿½ ç©ºæ–‡ä»¶å¤¹ï¼ˆHTML æ¨¡æ¿ç›´æ¥å†™åœ¨ä»£ç ä¸­ï¼‰
# æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚
Â 
## 1. æ™ºèƒ½åˆ†é¡µç®—æ³•
- æ¯é¡µå›ºå®šå°ºå¯¸ï¼š1080Ã—1440px (3:4æ¯”ä¾‹)
- åˆ†é¡µåŸåˆ™ï¼š
Â Â * æ®µè½å®Œæ•´æ€§ï¼šä¸åœ¨æ®µè½ä¸­é—´åˆ†é¡µ
Â Â * æ ‡é¢˜å…³è”ï¼šæ ‡é¢˜ä¸å…¶åç»­å†…å®¹ä¿æŒåŒé¡µ
Â Â * åˆ—è¡¨è¿ç»­ï¼šåˆ—è¡¨é¡¹å°½é‡ä¸åˆ†ç¦»
Â Â * ä»£ç å®Œæ•´ï¼šä»£ç å—ä¸è·¨é¡µ
Â Â * è§†è§‰å¹³è¡¡ï¼šé¿å…é¡µé¢è¿‡ç©ºæˆ–è¿‡æ»¡
Â 
## 2. æ ·å¼ç³»ç»Ÿ
- é¢„è®¾ä¸»é¢˜ï¼šå°çº¢ä¹¦ã€Instagramã€å¾®ä¿¡ã€çŸ¥ä¹ç­‰
- æ ·å¼è¦ç´ ï¼š
Â Â * å­—ä½“ï¼šä¸­æ–‡ç”¨è‹¹æ–¹/å¾®è½¯é›…é»‘ï¼Œè¥¿æ–‡ç”¨ Helvetica
Â Â * é¢œè‰²ï¼šä¸»è‰² #FF2442ï¼Œæ–‡å­— #333333
Â Â * é—´è·ï¼šæ®µè½é—´è· 20pxï¼Œè¡Œé«˜ 1.8
Â Â * ç‰¹æ•ˆï¼šå¡ç‰‡é˜´å½±ã€åœ†è§’ã€æ¸å˜èƒŒæ™¯
Â 
## 3. æ¸²æŸ“æµç¨‹
```python
# ä¼ªä»£ç ç¤ºä¾‹
markdown_text â†’ parse_markdown() â†’ generate_html() â†’ apply_styles() â†’ paginate() â†’ render_preview() â†’ export_images()
4. å¯¼å‡ºåŠŸèƒ½
Â 
æ ¼å¼ï¼šPNG/JPEG
è´¨é‡ï¼šæ”¯æŒ 1x/2x/3x åˆ†è¾¨ç‡
å‘½åï¼šè‡ªåŠ¨ç¼–å·ï¼Œå¦‚ card_01.png, card_02.png
æ‰¹é‡ï¼šä¸€æ¬¡å¯¼å‡ºæ‰€æœ‰åˆ†é¡µ
Â 
ä»£ç è§„èŒƒ
Â 
ä½¿ç”¨ç±»å‹æ³¨è§£ (typing)
éµå¾ª PEP 8
ä¸­æ–‡æ³¨é‡Šè¯´æ˜å…³é”®é€»è¾‘
é”™è¯¯å¤„ç†è¦å®Œå–„
Â 
æ€§èƒ½è¦æ±‚
Â 
å®æ—¶é¢„è§ˆå»¶è¿Ÿ < 300ms
æ”¯æŒ 10000 å­—çš„æ–‡æ¡£
å¯¼å‡ºé€Ÿåº¦ï¼šæ¯å¼ å¡ç‰‡ < 1ç§’
Â 
é—®é¢˜æè¿°
ç›®å‰æˆ‘çš„ä»£ç å¯¼å‡ºå›¾ç‰‡çš„æ—¶å€™ä¼šæŠ¥é”™ï¼šå¯¼å‡ºè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:
'PySide6.QtWebEngineCore.QWebEnginePage' object has no attribute 'setViewportSize'
èƒ½å¦æŒ‰ç…§æˆ‘ä»¬çš„æ€è·¯ï¼Œå®Œå–„å›¾ç‰‡å¯¼å‡ºåŠŸèƒ½ï¼Ÿåœ¨è¿™ä¹‹å‰ï¼Œè¿˜æœ‰æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿å¿˜è®°å¤„ç†ï¼Ÿè‹¥æ²¡æœ‰å¿˜è®°ï¼Œåˆ™å®Œå–„è¿™ä¸ªåŠŸèƒ½
æœŸæœ›è¾“å‡º
ä¿®æ”¹é—®é¢˜çš„ä»£ç ï¼›è‹¥ä¿®æ”¹å°åˆ™ç›´æ¥å‘Šè¯‰æˆ‘ä½ç½®ï¼Œæˆ‘ä¸ªäººè¿›è¡Œä¿®æ”¹ï¼›è‹¥å˜åŠ¨å¤§ï¼Œåˆ™ç»™æˆ‘è¿™ä¸ªæ–‡ä»¶çš„å®Œæ•´ä»£ç 
editor_widget.py->text/plain-># ============================================
# src/ui/editor_widget.py
# ============================================
from PySide6.QtWidgets import QTextEdit, QVBoxLayout, QWidget, QLabel, QFrame
from PySide6.QtGui import QFont, QTextOption, QPalette, QColor
from PySide6.QtCore import Signal, Qt

class EditorWidget(QWidget):
    textChanged = Signal()
    scrollChanged = Signal(float)  # å‘é€æ»šåŠ¨ç™¾åˆ†æ¯”
    
    def __init__(self):
        super().__init__()
        self.init_ui()
        
    def init_ui(self):
        """åˆå§‹åŒ–UI"""
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)
        
        # åˆ›å»ºå®¹å™¨æ¡†æ¶
        container = QFrame()
        container.setStyleSheet("""
            QFrame {
                background: rgba(25, 25, 40, 0.95);
                border: 1px solid rgba(0, 224, 255, 0.2);
                border-radius: 16px;
            }
        """)
        container_layout = QVBoxLayout(container)
        container_layout.setContentsMargins(0, 0, 0, 0)
        container_layout.setSpacing(0)
        
        # æ ‡é¢˜æ 
        title_bar = QFrame()
        title_bar.setFixedHeight(50)
        title_bar.setStyleSheet("""
            QFrame {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 0,
                    stop: 0 rgba(0, 224, 255, 0.1),
                    stop: 0.5 rgba(0, 150, 255, 0.15),
                    stop: 1 rgba(0, 224, 255, 0.1)
                );
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
                border-bottom: 1px solid rgba(0, 224, 255, 0.2);
                padding: 12px 20px;
            }
        """)
        title_layout = QVBoxLayout(title_bar)
        
        title = QLabel("âœï¸ Markdown ç¼–è¾‘å™¨")
        title.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-size: 16px;
                font-weight: 600;
                letter-spacing: 0.5px;
            }
        """)
        title_layout.addWidget(title)
        
        # ç¼–è¾‘å™¨
        self.editor = QTextEdit()
        self.editor.setFont(QFont("Cascadia Code, Consolas, Monaco", 12))
        self.editor.setLineWrapMode(QTextEdit.WidgetWidth)
        self.editor.setWordWrapMode(QTextOption.WordWrap)
        
        # è®¾ç½®ç¼–è¾‘å™¨æ ·å¼
        self.editor.setStyleSheet("""
            QTextEdit {
                border: none;
                padding: 25px;
                background-color: rgba(15, 15, 25, 0.6);
                color: #e0e6ed;
                selection-background-color: rgba(0, 224, 255, 0.3);
                selection-color: #ffffff;
                border-bottom-left-radius: 16px;
                border-bottom-right-radius: 16px;
                font-size: 14px;
                line-height: 1.6;
            }
            QScrollBar:vertical {
                background: rgba(20, 20, 35, 0.5);
                width: 12px;
                border-radius: 6px;
                margin: 5px;
            }
            QScrollBar::handle:vertical {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.4),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
                border-radius: 6px;
                min-height: 30px;
            }
            QScrollBar::handle:vertical:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.6),
                    stop: 1 rgba(0, 150, 255, 0.5)
                );
            }
            QScrollBar::add-line:vertical,
            QScrollBar::sub-line:vertical {
                border: none;
                background: none;
                height: 0;
            }
            QScrollBar:horizontal {
                background: rgba(20, 20, 35, 0.5);
                height: 12px;
                border-radius: 6px;
                margin: 5px;
            }
            QScrollBar::handle:horizontal {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 0,
                    stop: 0 rgba(0, 224, 255, 0.4),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
                border-radius: 6px;
                min-width: 30px;
            }
            QScrollBar::handle:horizontal:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 0,
                    stop: 0 rgba(0, 224, 255, 0.6),
                    stop: 1 rgba(0, 150, 255, 0.5)
                );
            }
            QScrollBar::add-line:horizontal,
            QScrollBar::sub-line:horizontal {
                border: none;
                background: none;
                width: 0;
            }
        """)
        
        # è®¾ç½®é»˜è®¤æ–‡æœ¬
        self.editor.setPlainText("""# ğŸŒ¸ å°çº¢ä¹¦ç¬”è®°æ ‡é¢˜

## ä»Šæ—¥åˆ†äº«

å¤§å®¶å¥½å‘€ï½ä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸€ä¸ªè¶…å®ç”¨çš„ **Markdown ç¼–è¾‘å™¨**ï¼

### âœ¨ ä¸»è¦åŠŸèƒ½

1. **å®æ—¶é¢„è§ˆ** - å·¦è¾¹å†™ï¼Œå³è¾¹çœ‹
2. **æ™ºèƒ½åˆ†é¡µ** - è‡ªåŠ¨é€‚é…å°çº¢ä¹¦å¡ç‰‡å°ºå¯¸
3. **ä¸€é”®å¯¼å‡º** - æ‰¹é‡ç”Ÿæˆç²¾ç¾å›¾ç‰‡

### ğŸ“ ä½¿ç”¨æ–¹æ³•

- åœ¨å·¦ä¾§è¾“å…¥ Markdown æ–‡æœ¬
- å³ä¾§å®æ—¶æ˜¾ç¤ºé¢„è§ˆæ•ˆæœ
- ç‚¹å‡»å¯¼å‡ºæŒ‰é’®ä¿å­˜å›¾ç‰‡

> ğŸ’¡ å°è´´å£«ï¼šæ”¯æŒæ‰€æœ‰å¸¸ç”¨çš„ Markdown è¯­æ³•å“¦ï½

### ä»£ç ç¤ºä¾‹

```python
def hello():
    print("Hello, å°çº¢ä¹¦!")
    return "â¤ï¸"
```

### è¡¨æ ¼ç¤ºä¾‹

| åŠŸèƒ½ | æè¿° | çŠ¶æ€ |
|------|------|------|
| ç¼–è¾‘ | Markdownç¼–è¾‘å™¨ | âœ… |
| é¢„è§ˆ | å®æ—¶æ¸²æŸ“ | âœ… |
| å¯¼å‡º | å›¾ç‰‡ç”Ÿæˆ | âœ… |

---

å–œæ¬¢çš„è¯è®°å¾— **ç‚¹èµæ”¶è—** å“¦ï½ â¤ï¸

å…³æ³¨æˆ‘ï¼Œè·å–æ›´å¤šå®ç”¨å·¥å…·ï¼""")
        
        # è¿æ¥ä¿¡å·
        self.editor.textChanged.connect(self.textChanged.emit)
        self.editor.verticalScrollBar().valueChanged.connect(self.on_scroll)
        
        # ç»„è£…å¸ƒå±€
        container_layout.addWidget(title_bar)
        container_layout.addWidget(self.editor)
        
        layout.addWidget(container)
        
    def get_text(self):
        """è·å–ç¼–è¾‘å™¨æ–‡æœ¬"""
        return self.editor.toPlainText()
    
    def on_scroll(self):
        """å¤„ç†æ»šåŠ¨äº‹ä»¶"""
        scrollbar = self.editor.verticalScrollBar()
        if scrollbar.maximum() > 0:
            percentage = scrollbar.value() / scrollbar.maximum()
            self.scrollChanged.emit(percentage) main_window.py->text/plain-># ============================================
# src/ui/main_window.py
# ============================================
from PySide6.QtWidgets import (QMainWindow, QHBoxLayout, QVBoxLayout, 
                               QWidget, QToolBar, QSplitter, QPushButton,
                               QFileDialog, QMessageBox, QStatusBar, QLabel,
                               QGraphicsDropShadowEffect)
from PySide6.QtCore import Qt, QTimer
from PySide6.QtGui import QAction, QIcon, QColor
from src.ui.editor_widget import EditorWidget
from src.ui.preview_widget import PreviewWidget

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        
        # å…ˆåˆ›å»ºè‡ªåŠ¨æ›´æ–°è®¡æ—¶å™¨
        self.update_timer = QTimer()
        self.update_timer.timeout.connect(self.update_preview)
        self.update_timer.setInterval(300)  # 300mså»¶è¿Ÿ
        
        # ç„¶ååˆå§‹åŒ–UI
        self.init_ui()
        self.setup_connections()
        
    def init_ui(self):
        """åˆå§‹åŒ–UI"""
        self.setWindowTitle("ğŸ“ å°çº¢ä¹¦ Markdown ç¼–è¾‘å™¨")
        self.setGeometry(100, 100, 1700, 950)
        
        # è®¾ç½®çª—å£æ ·å¼ - æ·±è‰²ç§‘æŠ€é£èƒŒæ™¯
        self.setStyleSheet("""
            QMainWindow {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 1,
                    stop: 0 #0f0f1e,
                    stop: 0.5 #1a1a2e, 
                    stop: 1 #16213e
                );
            }
        """)
        
        # åˆ›å»ºå·¥å…·æ 
        toolbar = QToolBar()
        toolbar.setMovable(False)
        toolbar.setFixedHeight(65)
        toolbar.setStyleSheet("""
            QToolBar {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(30, 30, 45, 0.95),
                    stop: 1 rgba(20, 20, 35, 0.98)
                );
                border: none;
                border-bottom: 2px solid rgba(0, 224, 255, 0.3);
                padding: 10px 15px;
                spacing: 12px;
            }
            QToolButton {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.15),
                    stop: 1 rgba(0, 150, 255, 0.1)
                );
                border: 1px solid rgba(0, 224, 255, 0.4);
                border-radius: 10px;
                padding: 10px 20px;
                color: #00e0ff;
                font-weight: 600;
                font-size: 14px;
                margin: 0 5px;
                letter-spacing: 0.5px;
                min-width: 120px;
            }
            QToolButton:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.25),
                    stop: 1 rgba(0, 150, 255, 0.2)
                );
                border: 1px solid rgba(0, 224, 255, 0.6);
                color: #00f0ff;
            }
            QToolButton:pressed {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.35),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
                border: 1px solid #00e0ff;
                color: white;
            }
        """)
        self.addToolBar(toolbar)
        
        # æ·»åŠ å·¥å…·æ æŒ‰é’®
        export_action = QAction("ğŸ“¸ å¯¼å‡ºå›¾ç‰‡", self)
        export_action.triggered.connect(self.export_images)
        toolbar.addAction(export_action)
        
        toolbar.addSeparator()
        
        clear_action = QAction("ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹", self)
        clear_action.triggered.connect(self.clear_content)
        toolbar.addAction(clear_action)
        
        # åˆ›å»ºçŠ¶æ€æ 
        self.status_bar = QStatusBar()
        self.status_bar.setFixedHeight(35)
        self.status_bar.setStyleSheet("""
            QStatusBar {
                background: rgba(20, 20, 35, 0.95);
                color: #8a92a6;
                border-top: 1px solid rgba(0, 224, 255, 0.2);
                padding: 6px 15px;
                font-size: 13px;
            }
            QStatusBar::item {
                border: none;
            }
        """)
        self.setStatusBar(self.status_bar)
        
        # æ·»åŠ çŠ¶æ€æ ä¿¡æ¯
        self.char_count_label = QLabel("å­—æ•°: 0")
        self.char_count_label.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-weight: 500;
                padding: 4px 12px;
                background: rgba(0, 224, 255, 0.1);
                border: 1px solid rgba(0, 224, 255, 0.3);
                border-radius: 12px;
            }
        """)
        self.status_bar.addPermanentWidget(self.char_count_label)
        
        # åˆ›å»ºä¸­å¿ƒéƒ¨ä»¶
        central_widget = QWidget()
        central_widget.setStyleSheet("""
            QWidget {
                background: transparent;
            }
        """)
        self.setCentralWidget(central_widget)
        
        # åˆ›å»ºå¸ƒå±€
        layout = QHBoxLayout(central_widget)
        layout.setContentsMargins(25, 25, 25, 25)
        layout.setSpacing(20)
        
        # åˆ›å»ºåˆ†å‰²å™¨
        splitter = QSplitter(Qt.Horizontal)
        splitter.setStyleSheet("""
            QSplitter::handle {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.2),
                    stop: 0.5 rgba(0, 224, 255, 0.4),
                    stop: 1 rgba(0, 224, 255, 0.2)
                );
                width: 3px;
                border-radius: 1px;
            }
            QSplitter::handle:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.3),
                    stop: 0.5 rgba(0, 224, 255, 0.6),
                    stop: 1 rgba(0, 224, 255, 0.3)
                );
            }
        """)
        
        # åˆ›å»ºç¼–è¾‘å™¨å’Œé¢„è§ˆç»„ä»¶
        self.editor = EditorWidget()
        self.preview = PreviewWidget()
        
        # æ·»åŠ é˜´å½±æ•ˆæœ
        self.add_shadow_effect(self.editor)
        self.add_shadow_effect(self.preview)
        
        # æ·»åŠ åˆ°åˆ†å‰²å™¨
        splitter.addWidget(self.editor)
        splitter.addWidget(self.preview)
        splitter.setSizes([850, 850])  # è®¾ç½®åˆå§‹å®½åº¦
        
        layout.addWidget(splitter)
        
        # åˆå§‹æ›´æ–°
        self.update_preview()
        self.update_char_count()
    
    def add_shadow_effect(self, widget):
        """ä¸ºç»„ä»¶æ·»åŠ é˜´å½±æ•ˆæœ"""
        shadow = QGraphicsDropShadowEffect()
        shadow.setBlurRadius(30)
        shadow.setXOffset(0)
        shadow.setYOffset(5)
        shadow.setColor(QColor(0, 224, 255, 50))
        widget.setGraphicsEffect(shadow)
        
    def setup_connections(self):
        """è®¾ç½®ä¿¡å·è¿æ¥"""
        self.editor.textChanged.connect(self.on_text_changed)
        self.editor.scrollChanged.connect(self.preview.handle_scroll)
        self.preview.pageChanged.connect(self.on_page_changed)
        
    def on_text_changed(self):
        """æ–‡æœ¬æ”¹å˜æ—¶å¯åŠ¨è®¡æ—¶å™¨"""
        self.update_timer.stop()
        self.update_timer.start()
        self.update_char_count()
        
    def update_preview(self):
        """æ›´æ–°é¢„è§ˆ"""
        self.update_timer.stop()
        markdown_text = self.editor.get_text()
        self.preview.update_content(markdown_text)
        
    def update_char_count(self):
        """æ›´æ–°å­—æ•°ç»Ÿè®¡"""
        text = self.editor.get_text()
        char_count = len(text.replace(" ", "").replace("\n", ""))
        self.char_count_label.setText(f"å­—æ•°: {char_count}")
        
    def on_page_changed(self, current, total):
        """é¡µç æ”¹å˜æ—¶æ›´æ–°çŠ¶æ€æ """
        self.status_bar.showMessage(f"é¡µé¢: {current}/{total}", 2000)
        
    def clear_content(self):
        """æ¸…ç©ºå†…å®¹"""
        reply = QMessageBox.question(
            self, "ç¡®è®¤æ¸…ç©º",
            "ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ",
            QMessageBox.Yes | QMessageBox.No,
            QMessageBox.No
        )
        
        if reply == QMessageBox.Yes:
            self.editor.editor.clear()
            
    def export_images(self):
        """å¯¼å‡ºå›¾ç‰‡"""
        folder = QFileDialog.getExistingDirectory(self, "é€‰æ‹©å¯¼å‡ºæ–‡ä»¶å¤¹")
        if folder:
            try:
                self.preview.export_pages(folder)
                QMessageBox.information(
                    self, "å¯¼å‡ºæˆåŠŸ",
                    f"å›¾ç‰‡å·²æˆåŠŸå¯¼å‡ºåˆ°:\n{folder}",
                    QMessageBox.Ok
                )
            except Exception as e:
                QMessageBox.critical(
                    self, "å¯¼å‡ºå¤±è´¥",
                    f"å¯¼å‡ºè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:\n{str(e)}",
                    QMessageBox.Ok
                ) preview_widget.py->text/plain-># ============================================
# src/ui/preview_widget.py
# ============================================
from PySide6.QtWidgets import QWidget, QVBoxLayout, QLabel, QFrame, QPushButton, QHBoxLayout
from PySide6.QtWebEngineWidgets import QWebEngineView
from PySide6.QtCore import QUrl, QTimer, Signal, Qt
from PySide6.QtGui import QImage, QPainter
import os
from pathlib import Path
from src.core.markdown_processor import MarkdownProcessor
from src.core.html_generator import HTMLGenerator

class PreviewWidget(QWidget):
    pageChanged = Signal(int, int)  # å½“å‰é¡µï¼Œæ€»é¡µæ•°
    
    def __init__(self):
        super().__init__()
        self.current_pages = []
        self.current_page = 1
        self.total_pages = 1
        self.init_ui()
        
    def init_ui(self):
        """åˆå§‹åŒ–UI"""
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)
        
        # åˆ›å»ºå®¹å™¨æ¡†æ¶
        container = QFrame()
        container.setStyleSheet("""
            QFrame {
                background: rgba(25, 25, 40, 0.95);
                border: 1px solid rgba(0, 224, 255, 0.2);
                border-radius: 16px;
            }
        """)
        container_layout = QVBoxLayout(container)
        container_layout.setContentsMargins(0, 0, 0, 0)
        container_layout.setSpacing(0)
        
        # æ ‡é¢˜æ 
        title_bar = QFrame()
        title_bar.setFixedHeight(50)
        title_bar.setStyleSheet("""
            QFrame {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 0,
                    stop: 0 rgba(0, 224, 255, 0.1),
                    stop: 0.5 rgba(0, 150, 255, 0.15),
                    stop: 1 rgba(0, 224, 255, 0.1)
                );
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
                border-bottom: 1px solid rgba(0, 224, 255, 0.2);
                padding: 12px 20px;
            }
        """)
        title_layout = QHBoxLayout(title_bar)
        
        title = QLabel("ğŸ‘€ å®æ—¶é¢„è§ˆ")
        title.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-size: 16px;
                font-weight: 600;
                letter-spacing: 0.5px;
            }
        """)
        
        # é¡µç æ˜¾ç¤º
        self.page_label = QLabel("ç¬¬ 1/1 é¡µ")
        self.page_label.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-size: 13px;
                font-weight: 500;
                padding: 5px 15px;
                background: rgba(0, 224, 255, 0.1);
                border: 1px solid rgba(0, 224, 255, 0.3);
                border-radius: 15px;
            }
        """)
        
        title_layout.addWidget(title)
        title_layout.addStretch()
        title_layout.addWidget(self.page_label)
        
        # Webè§†å›¾
        self.web_view = QWebEngineView()
        self.web_view.setStyleSheet("""
            QWebEngineView {
                border: none;
                background: rgba(15, 15, 25, 0.6);
            }
        """)
        
        # ç¿»é¡µæ§åˆ¶æ 
        control_bar = QFrame()
        control_bar.setFixedHeight(60)
        control_bar.setStyleSheet("""
            QFrame {
                background: rgba(20, 20, 35, 0.8);
                padding: 10px 20px;
                border-bottom-left-radius: 16px;
                border-bottom-right-radius: 16px;
                border-top: 1px solid rgba(0, 224, 255, 0.1);
            }
        """)
        control_layout = QHBoxLayout(control_bar)
        
        self.prev_btn = QPushButton("â¬… ä¸Šä¸€é¡µ")
        self.prev_btn.setFixedSize(120, 36)
        self.prev_btn.setStyleSheet("""
            QPushButton {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.15),
                    stop: 1 rgba(0, 150, 255, 0.1)
                );
                border: 1px solid rgba(0, 224, 255, 0.4);
                color: #00e0ff;
                padding: 8px 16px;
                border-radius: 8px;
                font-weight: 600;
                font-size: 13px;
            }
            QPushButton:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.25),
                    stop: 1 rgba(0, 150, 255, 0.2)
                );
                border: 1px solid rgba(0, 224, 255, 0.6);
            }
            QPushButton:pressed {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.35),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
            }
            QPushButton:disabled {
                background: rgba(30, 30, 45, 0.5);
                border-color: rgba(100, 100, 120, 0.3);
                color: rgba(100, 100, 120, 0.5);
            }
        """)
        
        self.next_btn = QPushButton("ä¸‹ä¸€é¡µ â¡")
        self.next_btn.setFixedSize(120, 36)
        self.next_btn.setStyleSheet("""
            QPushButton {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.15),
                    stop: 1 rgba(0, 150, 255, 0.1)
                );
                border: 1px solid rgba(0, 224, 255, 0.4);
                color: #00e0ff;
                padding: 8px 16px;
                border-radius: 8px;
                font-weight: 600;
                font-size: 13px;
            }
            QPushButton:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.25),
                    stop: 1 rgba(0, 150, 255, 0.2)
                );
                border: 1px solid rgba(0, 224, 255, 0.6);
            }
            QPushButton:pressed {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.35),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
            }
            QPushButton:disabled {
                background: rgba(30, 30, 45, 0.5);
                border-color: rgba(100, 100, 120, 0.3);
                color: rgba(100, 100, 120, 0.5);
            }
        """)
        
        control_layout.addWidget(self.prev_btn)
        control_layout.addStretch()
        control_layout.addWidget(self.next_btn)
        
        # ç»„è£…å¸ƒå±€
        container_layout.addWidget(title_bar)
        container_layout.addWidget(self.web_view, 1)
        container_layout.addWidget(control_bar)
        
        layout.addWidget(container)
        
        # å¤„ç†å™¨
        self.markdown_processor = MarkdownProcessor()
        self.html_generator = HTMLGenerator()
        
        # è¿æ¥ä¿¡å·
        self.prev_btn.clicked.connect(self.prev_page)
        self.next_btn.clicked.connect(self.next_page)
        
        # åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
        self.update_buttons()
        
    def update_content(self, markdown_text: str):
        """æ›´æ–°é¢„è§ˆå†…å®¹"""
        try:
            # å¤„ç† Markdown
            html_content = self.markdown_processor.parse(markdown_text)
            
            # ç”Ÿæˆå®Œæ•´HTML
            full_html = self.html_generator.generate(html_content)
            
            # åŠ è½½åˆ°WebView
            self.web_view.setHtml(full_html, QUrl("file:///"))
            
            # ä¿å­˜å½“å‰é¡µé¢ï¼ˆç”¨äºå¯¼å‡ºï¼‰
            self.current_html = full_html
            
            # æ›´æ–°é¡µç æ˜¾ç¤º
            self.update_page_info()
            
        except Exception as e:
            error_html = f"""
            <html>
            <body style="padding: 20px; font-family: sans-serif; background: #1a1a2e; color: #e0e6ed;">
                <h3 style="color: #ff4757;">é¢„è§ˆé”™è¯¯</h3>
                <p style="color: #8a92a6;">{str(e)}</p>
            </body>
            </html>
            """
            self.web_view.setHtml(error_html)
    
    def prev_page(self):
        """ä¸Šä¸€é¡µ"""
        if self.current_page > 1:
            self.current_page -= 1
            self.update_page_display()
            self.update_buttons()
    
    def next_page(self):
        """ä¸‹ä¸€é¡µ"""
        if self.current_page < self.total_pages:
            self.current_page += 1
            self.update_page_display()
            self.update_buttons()
    
    def update_page_display(self):
        """æ›´æ–°é¡µé¢æ˜¾ç¤ºï¼ˆé¢„ç•™æ¥å£ï¼‰"""
        # è¿™é‡Œå¯ä»¥å®ç°çœŸæ­£çš„åˆ†é¡µé€»è¾‘
        pass
    
    def update_buttons(self):
        """æ›´æ–°æŒ‰é’®çŠ¶æ€"""
        self.prev_btn.setEnabled(self.current_page > 1)
        self.next_btn.setEnabled(self.current_page < self.total_pages)
    
    def update_page_info(self):
        """æ›´æ–°é¡µç ä¿¡æ¯"""
        self.page_label.setText(f"ç¬¬ {self.current_page}/{self.total_pages} é¡µ")
        self.pageChanged.emit(self.current_page, self.total_pages)
    
    def export_pages(self, folder: str):
        """å¯¼å‡ºé¡µé¢ä¸ºå›¾ç‰‡"""
        page = self.web_view.page()
        
        # è®¾ç½®é¡µé¢å¤§å°ä¸ºå°çº¢ä¹¦å¡ç‰‡å°ºå¯¸ï¼ˆ1080x1440ï¼‰
        page.setViewportSize(page.contentsSize().toSize())
        
        # åˆ›å»ºä¿å­˜è·¯å¾„
        save_path = Path(folder) / f"card_{self.current_page:02d}.png"
        
        # æˆªå›¾å¹¶ä¿å­˜
        def save_screenshot(pixmap):
            # åˆ›å»ºå°çº¢ä¹¦å°ºå¯¸çš„å›¾ç‰‡
            target_image = QImage(1080, 1440, QImage.Format_ARGB32)
            target_image.fill(Qt.white)
            
            # ç»˜åˆ¶å†…å®¹
            painter = QPainter(target_image)
            scaled_pixmap = pixmap.scaled(
                1080, 1440,
                Qt.KeepAspectRatio,
                Qt.SmoothTransformation
            )
            
            # å±…ä¸­ç»˜åˆ¶
            x = (1080 - scaled_pixmap.width()) // 2
            y = (1440 - scaled_pixmap.height()) // 2
            painter.drawPixmap(x, y, scaled_pixmap)
            painter.end()
            
            # ä¿å­˜
            target_image.save(str(save_path), "PNG", 100)
            
        page.grabToImage(save_screenshot)
    
    def handle_scroll(self, percentage: float):
        """å¤„ç†ç¼–è¾‘å™¨æ»šåŠ¨åŒæ­¥"""
        # é€šè¿‡JavaScriptåŒæ­¥æ»šåŠ¨
        script = f"""
        var content = document.getElementById('content');
        if (content) {{
            content.scrollTop = content.scrollHeight * {percentage};
        }}
        """
        self.web_view.page().runJavaScript(script) html_generator.py->text/plain-># ============================================
# src/core/html_generator.py
# ============================================
from pathlib import Path

class HTMLGenerator:
    def __init__(self):
        self.resource_path = Path(__file__).parent.parent / "resources"
        
    def generate(self, content: str) -> str:
        """ç”Ÿæˆå®Œæ•´çš„ HTML é¡µé¢"""
        css = self.get_css()
        js = self.get_js()
        
        html = f"""
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çº¢ä¹¦å¡ç‰‡</title>
    <style>{css}</style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="content" id="content">
                {content}
            </div>
            <div class="watermark">
                <span>ğŸ“ å°çº¢ä¹¦ç¬”è®°</span>
            </div>
        </div>
    </div>
    <script>{js}</script>
</body>
</html>
"""
        return html
        
    def get_css(self) -> str:
        """è·å–ä¼˜åŒ–åçš„CSSæ ·å¼"""
        return """
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", 
                        "Helvetica Neue", "Hiragino Sans GB", "Microsoft YaHei UI",
                        "Microsoft YaHei", Arial, sans-serif;
            background: linear-gradient(135deg, #ffeef8 0%, #ffe0f0 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            width: 100%;
            max-width: 650px;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(255, 36, 66, 0.08),
                        0 2px 10px rgba(0, 0, 0, 0.06);
            overflow: hidden;
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(255, 36, 66, 0.12),
                        0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .content {
            padding: 45px 40px;
            color: #2c3e50;
            line-height: 1.8;
            min-height: 450px;
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            color: #FF2442;
            font-size: 30px;
            margin-bottom: 25px;
            font-weight: 700;
            letter-spacing: -0.5px;
            border-bottom: 3px solid #FFE4E4;
            padding-bottom: 15px;
        }
        
        h2 {
            color: #FF2442;
            font-size: 24px;
            margin-top: 35px;
            margin-bottom: 20px;
            font-weight: 600;
            position: relative;
            padding-left: 18px;
        }
        
        h2::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 5px;
            height: 22px;
            background: linear-gradient(180deg, #FF2442, #FF6B6B);
            border-radius: 3px;
        }
        
        h3 {
            color: #34495e;
            font-size: 20px;
            margin-top: 28px;
            margin-bottom: 16px;
            font-weight: 600;
        }
        
        /* æ®µè½æ ·å¼ */
        p {
            margin-bottom: 20px;
            font-size: 16px;
            color: #4a5568;
            text-align: justify;
        }
        
        /* å¼ºè°ƒæ ·å¼ */
        strong {
            color: #FF2442;
            font-weight: 600;
            background: linear-gradient(180deg, transparent 70%, #FFE4E4 70%);
            padding: 0 3px;
        }
        
        em {
            font-style: italic;
            color: #718096;
        }
        
        /* åˆ—è¡¨æ ·å¼ */
        ul, ol {
            margin: 22px 0;
            padding-left: 35px;
        }
        
        li {
            margin-bottom: 14px;
            font-size: 16px;
            color: #4a5568;
            line-height: 1.8;
        }
        
        ul li::marker {
            color: #FF2442;
            font-size: 18px;
        }
        
        ol li::marker {
            color: #FF2442;
            font-weight: 600;
        }
        
        /* å¼•ç”¨æ ·å¼ */
        blockquote {
            border-left: 4px solid #FF2442;
            margin: 26px 0;
            padding: 18px 26px;
            background: linear-gradient(90deg, #FFF8F8 0%, #FFFFFF 100%);
            border-radius: 10px;
            position: relative;
        }
        
        blockquote::before {
            content: '"';
            position: absolute;
            top: -8px;
            left: 22px;
            font-size: 45px;
            color: #FFE4E4;
            font-family: Georgia, serif;
        }
        
        blockquote p {
            color: #6b7280;
            font-style: italic;
            margin-bottom: 0;
        }
        
        /* è¡Œå†…ä»£ç  */
        code {
            background: #FFF5F5;
            padding: 4px 10px;
            border-radius: 6px;
            font-family: "JetBrains Mono", "Cascadia Code", "Consolas", "Monaco", monospace;
            font-size: 14px;
            color: #e53e3e;
            font-weight: 500;
        }
        
        /* ä»£ç å— */
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 24px;
            border-radius: 12px;
            overflow-x: auto;
            margin: 26px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            position: relative;
        }
        
        pre::before {
            content: "CODE";
            position: absolute;
            top: 10px;
            right: 14px;
            font-size: 11px;
            color: #6b7280;
            font-weight: 600;
            letter-spacing: 1px;
            opacity: 0.5;
        }
        
        pre code {
            background: none;
            color: #d4d4d4;
            padding: 0;
            font-size: 14px;
            line-height: 1.7;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 26px 0;
            font-size: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
            border-radius: 10px;
            overflow: hidden;
        }
        
        th {
            background: linear-gradient(135deg, #FF2442, #FF6B6B);
            color: white;
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 15px;
        }
        
        td {
            padding: 14px 18px;
            border-bottom: 1px solid #f0f0f0;
            color: #4a5568;
        }
        
        tr:nth-child(even) {
            background: #FAFAFA;
        }
        
        tr:hover {
            background: #FFF5F5;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        /* åˆ†éš”çº¿ */
        hr {
            border: none;
            height: 1px;
            background: linear-gradient(90deg, transparent, #FFE4E4 20%, #FFE4E4 80%, transparent);
            margin: 35px 0;
        }
        
        /* é“¾æ¥æ ·å¼ */
        a {
            color: #FF2442;
            text-decoration: none;
            border-bottom: 1px solid #FFD0D7;
            transition: all 0.3s ease;
            padding-bottom: 1px;
        }
        
        a:hover {
            color: #FF6B6B;
            border-bottom-color: #FF6B6B;
            background: #FFF5F5;
            padding: 0 3px;
            margin: 0 -3px;
            border-radius: 3px;
        }
        
        /* æ°´å°æ ·å¼ */
        .watermark {
            position: absolute;
            bottom: 22px;
            right: 25px;
            font-size: 13px;
            color: #CBD5E0;
            opacity: 0.5;
            font-weight: 500;
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f5f5f5;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #FF6B6B, #FF2442);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #FF2442, #FF1030);
        }
        """
    
    def get_js(self) -> str:
        """è·å–JavaScriptä»£ç """
        return """
        // ç›‘å¬ç¼–è¾‘å™¨æ»šåŠ¨äº‹ä»¶ï¼ˆé€šè¿‡postMessageï¼‰
        window.addEventListener('message', function(e) {
            if (e.data.type === 'scroll') {
                const content = document.getElementById('content');
                const scrollPercentage = e.data.percentage;
                content.scrollTop = content.scrollHeight * scrollPercentage;
            }
        });
        """ markdown_processor.py->text/plain-># ============================================
# src/core/markdown_processor.py
# ============================================
import markdown
from markdown.extensions import fenced_code, tables

class MarkdownProcessor:
    def __init__(self):
        # åªä½¿ç”¨å¿…è¦ä¸”ç¨³å®šçš„æ‰©å±•
        self.extensions = [
            'markdown.extensions.fenced_code',  # ä»£ç å—
            'markdown.extensions.tables',       # è¡¨æ ¼
            'markdown.extensions.nl2br',        # æ¢è¡Œè½¬<br>
            'markdown.extensions.attr_list',    # å±æ€§åˆ—è¡¨
            'markdown.extensions.def_list',     # å®šä¹‰åˆ—è¡¨
            'markdown.extensions.footnotes',    # è„šæ³¨
            'markdown.extensions.toc',          # ç›®å½•
            'markdown.extensions.sane_lists',   # æ”¹è¿›çš„åˆ—è¡¨
            'markdown.extensions.smarty',       # æ™ºèƒ½æ ‡ç‚¹
        ]
        
        # é…ç½®æ‰©å±•ï¼ˆç§»é™¤ä¸æ”¯æŒçš„ css_class å‚æ•°ï¼‰
        self.extension_configs = {}
        
    def parse(self, text: str) -> str:
        """è§£æ Markdown æ–‡æœ¬ä¸º HTML"""
        try:
            # åˆ›å»ºæ–°çš„ Markdown å®ä¾‹ï¼ˆé¿å…çŠ¶æ€æ±¡æŸ“ï¼‰
            md = markdown.Markdown(
                extensions=self.extensions,
                extension_configs=self.extension_configs
            )
            
            # è½¬æ¢ Markdown ä¸º HTML
            html = md.convert(text)
            
            # åå¤„ç†ï¼šæ·»åŠ å°çº¢ä¹¦ç‰¹è‰² emoji æ”¯æŒ
            html = self._process_emojis(html)
            
            return html
            
        except Exception as e:
            print(f"Markdown è§£æé”™è¯¯: {e}")
            return f"<p style='color: red;'>è§£æé”™è¯¯: {str(e)}</p>"
    
    def _process_emojis(self, html: str) -> str:
        """å¤„ç† emoji è¡¨æƒ…"""
        # ä¿æŒ emoji åŸæ ·æ˜¾ç¤º
        return html style_manager.py->text/plain->
### ç³»ç»Ÿ:
çœ‹äº†ä½ çš„ä»£ç ï¼Œæˆ‘å‘ç°äº†å‡ ä¸ªé—®é¢˜ï¼š

## é—®é¢˜åˆ†æ

1. **ä¸»è¦é”™è¯¯**ï¼š`QWebEnginePage` åœ¨ PySide6 ä¸­ç¡®å®æ²¡æœ‰ `setViewportSize` æ–¹æ³•ï¼Œè¿™æ˜¯æ—§ç‰ˆæœ¬ Qt çš„ API
2. **æˆªå›¾æ–¹æ³•é”™è¯¯**ï¼š`grabToImage` ä¹Ÿä¸æ˜¯æ­£ç¡®çš„æ–¹æ³•
3. **ç¼ºå°‘åˆ†é¡µé€»è¾‘**ï¼šè™½ç„¶æœ‰ç¿»é¡µæŒ‰é’®ï¼Œä½†å®é™…æ²¡æœ‰å®ç°åˆ†é¡µåŠŸèƒ½
4. **å¯¼å‡ºé€»è¾‘ä¸å®Œæ•´**ï¼šåªå¯¼å‡ºå½“å‰é¡µé¢ï¼Œè€Œä¸æ˜¯æ‰€æœ‰åˆ†é¡µ

## è§£å†³æ–¹æ¡ˆ

ç”±äºæ”¹åŠ¨è¾ƒå¤§ï¼Œæˆ‘ç»™ä½ å®Œæ•´çš„ `preview_widget.py` æ–‡ä»¶ï¼š ä»£ç 
```python
# ============================================
# src/ui/preview_widget.py
# ============================================
from PySide6.QtWidgets import QWidget, QVBoxLayout, QLabel, QFrame, QPushButton, QHBoxLayout, QProgressDialog
from PySide6.QtWebEngineWidgets import QWebEngineView
from PySide6.QtCore import QUrl, QTimer, Signal, Qt, QEventLoop, QSize
from PySide6.QtGui import QImage, QPainter, QPageSize
from PySide6.QtPrintSupport import QPrinter
import os
from pathlib import Path
from src.core.markdown_processor import MarkdownProcessor
from src.core.html_generator import HTMLGenerator
import base64
import time

class PreviewWidget(QWidget):
    pageChanged = Signal(int, int)  # å½“å‰é¡µï¼Œæ€»é¡µæ•°
    
    def __init__(self):
        super().__init__()
        self.current_pages = []
        self.current_page = 1
        self.total_pages = 1
        self.markdown_text = ""  # ä¿å­˜åŸå§‹markdownæ–‡æœ¬
        self.init_ui()
        
    def init_ui(self):
        """åˆå§‹åŒ–UI"""
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)
        
        # åˆ›å»ºå®¹å™¨æ¡†æ¶
        container = QFrame()
        container.setStyleSheet("""
            QFrame {
                background: rgba(25, 25, 40, 0.95);
                border: 1px solid rgba(0, 224, 255, 0.2);
                border-radius: 16px;
            }
        """)
        container_layout = QVBoxLayout(container)
        container_layout.setContentsMargins(0, 0, 0, 0)
        container_layout.setSpacing(0)
        
        # æ ‡é¢˜æ 
        title_bar = QFrame()
        title_bar.setFixedHeight(50)
        title_bar.setStyleSheet("""
            QFrame {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 0,
                    stop: 0 rgba(0, 224, 255, 0.1),
                    stop: 0.5 rgba(0, 150, 255, 0.15),
                    stop: 1 rgba(0, 224, 255, 0.1)
                );
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
                border-bottom: 1px solid rgba(0, 224, 255, 0.2);
                padding: 12px 20px;
            }
        """)
        title_layout = QHBoxLayout(title_bar)
        
        title = QLabel("ğŸ‘€ å®æ—¶é¢„è§ˆ")
        title.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-size: 16px;
                font-weight: 600;
                letter-spacing: 0.5px;
            }
        """)
        
        # é¡µç æ˜¾ç¤º
        self.page_label = QLabel("ç¬¬ 1/1 é¡µ")
        self.page_label.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-size: 13px;
                font-weight: 500;
                padding: 5px 15px;
                background: rgba(0, 224, 255, 0.1);
                border: 1px solid rgba(0, 224, 255, 0.3);
                border-radius: 15px;
            }
        """)
        
        title_layout.addWidget(title)
        title_layout.addStretch()
        title_layout.addWidget(self.page_label)
        
        # Webè§†å›¾
        self.web_view = QWebEngineView()
        self.web_view.setStyleSheet("""
            QWebEngineView {
                border: none;
                background: rgba(15, 15, 25, 0.6);
            }
        """)
        
        # ç¿»é¡µæ§åˆ¶æ 
        control_bar = QFrame()
        control_bar.setFixedHeight(60)
        control_bar.setStyleSheet("""
            QFrame {
                background: rgba(20, 20, 35, 0.8);
                padding: 10px 20px;
                border-bottom-left-radius: 16px;
                border-bottom-right-radius: 16px;
                border-top: 1px solid rgba(0, 224, 255, 0.1);
            }
        """)
        control_layout = QHBoxLayout(control_bar)
        
        self.prev_btn = QPushButton("â¬… ä¸Šä¸€é¡µ")
        self.prev_btn.setFixedSize(120, 36)
        self.prev_btn.setStyleSheet("""
            QPushButton {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.15),
                    stop: 1 rgba(0, 150, 255, 0.1)
                );
                border: 1px solid rgba(0, 224, 255, 0.4);
                color: #00e0ff;
                padding: 8px 16px;
                border-radius: 8px;
                font-weight: 600;
                font-size: 13px;
            }
            QPushButton:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.25),
                    stop: 1 rgba(0, 150, 255, 0.2)
                );
                border: 1px solid rgba(0, 224, 255, 0.6);
            }
            QPushButton:pressed {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.35),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
            }
            QPushButton:disabled {
                background: rgba(30, 30, 45, 0.5);
                border-color: rgba(100, 100, 120, 0.3);
                color: rgba(100, 100, 120, 0.5);
            }
        """)
        
        self.next_btn = QPushButton("ä¸‹ä¸€é¡µ â¡")
        self.next_btn.setFixedSize(120, 36)
        self.next_btn.setStyleSheet("""
            QPushButton {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.15),
                    stop: 1 rgba(0, 150, 255, 0.1)
                );
                border: 1px solid rgba(0, 224, 255, 0.4);
                color: #00e0ff;
                padding: 8px 16px;
                border-radius: 8px;
                font-weight: 600;
                font-size: 13px;
            }
            QPushButton:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.25),
                    stop: 1 rgba(0, 150, 255, 0.2)
                );
                border: 1px solid rgba(0, 224, 255, 0.6);
            }
            QPushButton:pressed {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.35),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
            }
            QPushButton:disabled {
                background: rgba(30, 30, 45, 0.5);
                border-color: rgba(100, 100, 120, 0.3);
                color: rgba(100, 100, 120, 0.5);
            }
        """)
        
        control_layout.addWidget(self.prev_btn)
        control_layout.addStretch()
        control_layout.addWidget(self.next_btn)
        
        # ç»„è£…å¸ƒå±€
        container_layout.addWidget(title_bar)
        container_layout.addWidget(self.web_view, 1)
        container_layout.addWidget(control_bar)
        
        layout.addWidget(container)
        
        # å¤„ç†å™¨
        self.markdown_processor = MarkdownProcessor()
        self.html_generator = HTMLGenerator()
        
        # è¿æ¥ä¿¡å·
        self.prev_btn.clicked.connect(self.prev_page)
        self.next_btn.clicked.connect(self.next_page)
        
        # åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
        self.update_buttons()
        
    def update_content(self, markdown_text: str):
        """æ›´æ–°é¢„è§ˆå†…å®¹"""
        try:
            self.markdown_text = markdown_text  # ä¿å­˜åŸå§‹æ–‡æœ¬
            
            # å¤„ç† Markdown
            html_content = self.markdown_processor.parse(markdown_text)
            
            # åˆ†é¡µå¤„ç†
            self.current_pages = self.paginate_content(html_content)
            self.total_pages = len(self.current_pages) if self.current_pages else 1
            
            # ç¡®ä¿å½“å‰é¡µç æœ‰æ•ˆ
            if self.current_page > self.total_pages:
                self.current_page = 1
            
            # æ˜¾ç¤ºå½“å‰é¡µ
            self.display_current_page()
            
            # æ›´æ–°é¡µç æ˜¾ç¤ºå’ŒæŒ‰é’®
            self.update_page_info()
            self.update_buttons()
            
        except Exception as e:
            error_html = f"""
            <html>
            <body style="padding: 20px; font-family: sans-serif; background: #1a1a2e; color: #e0e6ed;">
                <h3 style="color: #ff4757;">é¢„è§ˆé”™è¯¯</h3>
                <p style="color: #8a92a6;">{str(e)}</p>
            </body>
            </html>
            """
            self.web_view.setHtml(error_html)
    
    def paginate_content(self, html_content: str) -> list:
        """
        ç®€å•çš„åˆ†é¡µé€»è¾‘ï¼šåŸºäºå­—ç¬¦æ•°åˆ†é¡µ
        å®é™…åº”ç”¨ä¸­åº”è¯¥ç”¨æ›´æ™ºèƒ½çš„ç®—æ³•ï¼ˆåŸºäºå…ƒç´ é«˜åº¦ï¼‰
        """
        # å¦‚æœå†…å®¹å¾ˆçŸ­ï¼Œä¸åˆ†é¡µ
        if len(html_content) < 1500:
            return [html_content]
        
        # ç®€å•åˆ†é¡µï¼šæ¯1500ä¸ªå­—ç¬¦ä¸€é¡µï¼ˆè¿™æ˜¯ç®€åŒ–ç‰ˆï¼Œå®é™…åº”è¯¥è§£æHTMLå¹¶æ™ºèƒ½åˆ†é¡µï¼‰
        pages = []
        max_chars_per_page = 1500
        
        # è¿™é‡Œåº”è¯¥ç”¨æ›´æ™ºèƒ½çš„æ–¹å¼åˆ†é¡µï¼Œæ¯”å¦‚ï¼š
        # 1. è§£æHTMLå…ƒç´ 
        # 2. è®¡ç®—æ¯ä¸ªå…ƒç´ çš„é¢„ä¼°é«˜åº¦
        # 3. æ ¹æ®é¡µé¢é«˜åº¦é™åˆ¶è¿›è¡Œåˆ†é¡µ
        # 4. ä¿æŒæ®µè½å®Œæ•´æ€§
        
        # ç®€åŒ–ç‰ˆå®ç°ï¼šæŒ‰å­—ç¬¦æ•°åˆ†å‰²
        start = 0
        while start < len(html_content):
            end = start + max_chars_per_page
            
            # å°è¯•åœ¨æ®µè½ç»“æŸå¤„åˆ†é¡µ
            if end < len(html_content):
                # æŸ¥æ‰¾æœ€è¿‘çš„æ®µè½ç»“æŸæ ‡è®°
                for tag in ['</p>', '</div>', '</ul>', '</ol>', '</blockquote>']:
                    last_tag = html_content.rfind(tag, start, end)
                    if last_tag != -1:
                        end = last_tag + len(tag)
                        break
            
            pages.append(html_content[start:end])
            start = end
        
        return pages if pages else [html_content]
    
    def display_current_page(self):
        """æ˜¾ç¤ºå½“å‰é¡µå†…å®¹"""
        if self.current_pages and 1 <= self.current_page <= len(self.current_pages):
            page_content = self.current_pages[self.current_page - 1]
            full_html = self.html_generator.generate(page_content)
            self.web_view.setHtml(full_html, QUrl("file:///"))
    
    def prev_page(self):
        """ä¸Šä¸€é¡µ"""
        if self.current_page > 1:
            self.current_page -= 1
            self.display_current_page()
            self.update_page_info()
            self.update_buttons()
    
    def next_page(self):
        """ä¸‹ä¸€é¡µ"""
        if self.current_page < self.total_pages:
            self.current_page += 1
            self.display_current_page()
            self.update_page_info()
            self.update_buttons()
    
    def update_buttons(self):
        """æ›´æ–°æŒ‰é’®çŠ¶æ€"""
        self.prev_btn.setEnabled(self.current_page > 1)
        self.next_btn.setEnabled(self.current_page < self.total_pages)
    
    def update_page_info(self):
        """æ›´æ–°é¡µç ä¿¡æ¯"""
        self.page_label.setText(f"ç¬¬ {self.current_page}/{self.total_pages} é¡µ")
        self.pageChanged.emit(self.current_page, self.total_pages)
    
    def export_pages(self, folder: str):
        """å¯¼å‡ºæ‰€æœ‰é¡µé¢ä¸ºå›¾ç‰‡"""
        try:
            # åˆ›å»ºè¿›åº¦å¯¹è¯æ¡†
            progress = QProgressDialog("æ­£åœ¨å¯¼å‡ºå›¾ç‰‡...", "å–æ¶ˆ", 0, self.total_pages, self)
            progress.setWindowModality(Qt.WindowModal)
            progress.setMinimumDuration(0)
            
            # ä¿å­˜å½“å‰é¡µç 
            original_page = self.current_page
            
            # é€é¡µå¯¼å‡º
            for page_num in range(1, self.total_pages + 1):
                if progress.wasCanceled():
                    break
                
                progress.setValue(page_num - 1)
                progress.setLabelText(f"æ­£åœ¨å¯¼å‡ºç¬¬ {page_num}/{self.total_pages} é¡µ...")
                
                # åˆ‡æ¢åˆ°è¦å¯¼å‡ºçš„é¡µé¢
                self.current_page = page_num
                self.display_current_page()
                
                # ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
                QTimer.singleShot(500, lambda: None)  # ç»™é¡µé¢æ¸²æŸ“ä¸€äº›æ—¶é—´
                loop = QEventLoop()
                QTimer.singleShot(500, loop.quit)
                loop.exec()
                
                # å¯¼å‡ºå½“å‰é¡µ
                self.export_current_page(folder, page_num)
            
            # æ¢å¤åŸå§‹é¡µç 
            self.current_page = original_page
            self.display_current_page()
            self.update_page_info()
            self.update_buttons()
            
            progress.setValue(self.total_pages)
            
        except Exception as e:
            raise Exception(f"å¯¼å‡ºå¤±è´¥: {str(e)}")
    
    def export_current_page(self, folder: str, page_num: int):
        """å¯¼å‡ºå½“å‰é¡µé¢ä¸ºå›¾ç‰‡ï¼ˆä½¿ç”¨PDFä½œä¸ºä¸­é—´æ ¼å¼ï¼‰"""
        try:
            save_path = Path(folder) / f"card_{page_num:02d}.png"
            
            # æ–¹æ³•1ï¼šä½¿ç”¨printToPdfç„¶åè½¬æ¢ï¼ˆæ›´å¯é ï¼‰
            self.export_via_pdf(save_path)
            
        except Exception as e:
            # å¦‚æœPDFæ–¹æ³•å¤±è´¥ï¼Œå°è¯•ç›´æ¥æˆªå›¾
            self.export_via_screenshot(save_path)
    
    def export_via_pdf(self, save_path: Path):
        """é€šè¿‡PDFä¸­é—´æ ¼å¼å¯¼å‡ºï¼ˆæœ€å¯é çš„æ–¹æ³•ï¼‰"""
        try:
            # ä¸´æ—¶PDFæ–‡ä»¶
            temp_pdf = save_path.with_suffix('.pdf')
            
            # åˆ›å»ºPDFæ‰“å°æœº
            printer = QPrinter(QPrinter.HighResolution)
            printer.setOutputFormat(QPrinter.PdfFormat)
            printer.setOutputFileName(str(temp_pdf))
            
            # è®¾ç½®é¡µé¢å¤§å°ä¸ºå°çº¢ä¹¦å¡ç‰‡æ¯”ä¾‹
            # ä½¿ç”¨A4çš„ä¸€éƒ¨åˆ†æ¥ä¿æŒ3:4æ¯”ä¾‹
            printer.setPageSize(QPageSize(QSize(210, 280), QPageSize.Millimeter))
            printer.setPageMargins(0, 0, 0, 0, QPrinter.Millimeter)
            
            # æ‰“å°åˆ°PDFï¼ˆåŒæ­¥æ–¹å¼ï¼‰
            loop = QEventLoop()
            
            def on_pdf_printed(file_path, success):
                if success:
                    # PDFç”ŸæˆæˆåŠŸï¼Œè½¬æ¢ä¸ºPNG
                    self.convert_pdf_to_png(temp_pdf, save_path)
                loop.quit()
            
            self.web_view.page().printToPdf(str(temp_pdf))
            # ç­‰å¾…ä¸€æ®µæ—¶é—´è®©PDFç”Ÿæˆ
            QTimer.singleShot(2000, loop.quit)
            loop.exec()
            
            # æ£€æŸ¥PDFæ˜¯å¦ç”Ÿæˆ
            if temp_pdf.exists():
                # è¿™é‡Œéœ€è¦é¢å¤–çš„åº“æ¥è½¬æ¢PDFåˆ°PNG
                # ç”±äºPySide6é™åˆ¶ï¼Œæˆ‘ä»¬æš‚æ—¶ä¿ç•™PDF
                # å®é™…é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨ pdf2image åº“
                temp_pdf.rename(save_path.with_suffix('.pdf'))
                print(f"å¯¼å‡ºä¸ºPDF: {save_path.with_suffix('.pdf')}")
            
        except Exception as e:
            print(f"PDFå¯¼å‡ºå¤±è´¥: {e}")
            raise
    
    def export_via_screenshot(self, save_path: Path):
        """ç›´æ¥æˆªå›¾æ–¹å¼å¯¼å‡ºï¼ˆå¤‡ç”¨æ–¹æ³•ï¼‰"""
        try:
            # ä½¿ç”¨renderæ–¹æ³•æ¸²æŸ“åˆ°å›¾ç‰‡
            size = self.web_view.size()
            image = QImage(1080, 1440, QImage.Format_ARGB32)
            image.fill(Qt.white)
            
            # åˆ›å»ºpainterå¹¶æ¸²æŸ“
            painter = QPainter(image)
            self.web_view.render(painter)
            painter.end()
            
            # ä¿å­˜å›¾ç‰‡
            image.save(str(save_path), "PNG", 100)
            print(f"å¯¼å‡ºæˆªå›¾: {save_path}")
            
        except Exception as e:
            print(f"æˆªå›¾å¯¼å‡ºå¤±è´¥: {e}")
            raise
    
    def convert_pdf_to_png(self, pdf_path: Path, png_path: Path):
        """å°†PDFè½¬æ¢ä¸ºPNGï¼ˆéœ€è¦é¢å¤–åº“ï¼‰"""
        # è¿™é‡Œéœ€è¦ä½¿ç”¨ pdf2image æˆ–å…¶ä»–åº“
        # æš‚æ—¶è·³è¿‡å®ç°
        pass
    
    def handle_scroll(self, percentage: float):
        """å¤„ç†ç¼–è¾‘å™¨æ»šåŠ¨åŒæ­¥"""
        # é€šè¿‡JavaScriptåŒæ­¥æ»šåŠ¨
        script = f"""
        var content = document.getElementById('content');
        if (content) {{
            content.scrollTop = content.scrollHeight * {percentage};
        }}
        """
        self.web_view.page().runJavaScript(script)
```
 ## ä¸»è¦ä¿®æ”¹è¯´æ˜

### 1. **ç§»é™¤äº†é”™è¯¯çš„APIè°ƒç”¨**
- åˆ é™¤äº† `page.setViewportSize()` 
- åˆ é™¤äº† `page.grabToImage()`

### 2. **æ·»åŠ äº†åˆ†é¡µåŠŸèƒ½**
- `paginate_content()`: ç®€å•çš„åˆ†é¡µç®—æ³•ï¼ˆåŸºäºå­—ç¬¦æ•°ï¼‰
- `display_current_page()`: æ˜¾ç¤ºæŒ‡å®šé¡µé¢
- ä¿å­˜äº†åˆ†é¡µåçš„å†…å®¹åˆ—è¡¨

### 3. **æ”¹è¿›äº†å¯¼å‡ºåŠŸèƒ½**
- `export_pages()`: æ‰¹é‡å¯¼å‡ºæ‰€æœ‰é¡µé¢
- `export_current_page()`: å¯¼å‡ºå•é¡µ
- ä½¿ç”¨ä¸¤ç§å¯¼å‡ºæ–¹æ³•ï¼š
  - **PDFæ–¹å¼**ï¼šæ›´å¯é ï¼Œé€šè¿‡ `printToPdf`
  - **æˆªå›¾æ–¹å¼**ï¼šå¤‡ç”¨æ–¹æ¡ˆï¼Œé€šè¿‡ `render`

### 4. **æ·»åŠ äº†è¿›åº¦æ¡**
- å¯¼å‡ºæ—¶æ˜¾ç¤ºè¿›åº¦å¯¹è¯æ¡†
- ç”¨æˆ·å¯ä»¥å–æ¶ˆæ“ä½œ

## é¢å¤–å»ºè®®

å¦‚æœä½ æƒ³è¦æ›´å®Œå–„çš„åŠŸèƒ½ï¼Œå»ºè®®ï¼š

### 1. **å®‰è£…é¢å¤–ä¾èµ–**ï¼ˆç”¨äºPDFè½¬PNGï¼‰
```bash
pip install pdf2image pillow
```

### 2. **åˆ›å»ºæ™ºèƒ½åˆ†é¡µå™¨** `src/utils/paginator.py`ï¼š ä»£ç 
```python
# ============================================
# src/utils/paginator.py
# ============================================
from typing import List, Tuple
import re
from dataclasses import dataclass

@dataclass
class PageElement:
    """é¡µé¢å…ƒç´ """
    content: str
    element_type: str  # 'heading', 'paragraph', 'list', 'code', 'table', 'blockquote'
    estimated_height: int  # é¢„ä¼°é«˜åº¦ï¼ˆåƒç´ ï¼‰
    can_break: bool  # æ˜¯å¦å¯ä»¥åœ¨æ­¤å¤„åˆ†é¡µ

class SmartPaginator:
    """æ™ºèƒ½åˆ†é¡µå™¨"""
    
    # å°çº¢ä¹¦å¡ç‰‡å°ºå¯¸
    PAGE_WIDTH = 1080
    PAGE_HEIGHT = 1440
    
    # å†…å®¹åŒºåŸŸï¼ˆæ‰£é™¤paddingåï¼‰
    CONTENT_HEIGHT = 1300
    
    # å…ƒç´ é«˜åº¦ä¼°ç®—ï¼ˆåƒç´ ï¼‰
    HEIGHTS = {
        'h1': 80,
        'h2': 60,
        'h3': 50,
        'p': 60,  # å¹³å‡3è¡Œæ–‡å­—
        'li': 40,
        'code_line': 25,
        'blockquote': 100,
        'table_row': 45,
        'hr': 50,
        'img': 300,
    }
    
    def __init__(self):
        self.elements = []
    
    def parse_html_to_elements(self, html_content: str) -> List[PageElement]:
        """å°†HTMLè§£æä¸ºå…ƒç´ åˆ—è¡¨"""
        elements = []
        
        # ç®€åŒ–çš„HTMLè§£æï¼ˆå®é™…åº”è¯¥ç”¨BeautifulSoupï¼‰
        patterns = [
            (r'<h1[^>]*>(.*?)</h1>', 'h1', self.HEIGHTS['h1'], False),
            (r'<h2[^>]*>(.*?)</h2>', 'h2', self.HEIGHTS['h2'], False),
            (r'<h3[^>]*>(.*?)</h3>', 'h3', self.HEIGHTS['h3'], False),
            (r'<p[^>]*>(.*?)</p>', 'p', self.HEIGHTS['p'], True),
            (r'<li[^>]*>(.*?)</li>', 'li', self.HEIGHTS['li'], True),
            (r'<blockquote[^>]*>(.*?)</blockquote>', 'blockquote', self.HEIGHTS['blockquote'], True),
            (r'<hr[^>]*/?>', 'hr', self.HEIGHTS['hr'], True),
        ]
        
        # æŒ‰ä½ç½®æ’åºæ‰€æœ‰åŒ¹é…
        all_matches = []
        for pattern, elem_type, height, can_break in patterns:
            for match in re.finditer(pattern, html_content, re.DOTALL):
                all_matches.append({
                    'start': match.start(),
                    'end': match.end(),
                    'content': match.group(0),
                    'type': elem_type,
                    'height': self.estimate_height(match.group(1) if match.groups() else "", elem_type),
                    'can_break': can_break
                })
        
        # æŒ‰ä½ç½®æ’åº
        all_matches.sort(key=lambda x: x['start'])
        
        # è½¬æ¢ä¸ºPageElementå¯¹è±¡
        for match in all_matches:
            elements.append(PageElement(
                content=match['content'],
                element_type=match['type'],
                estimated_height=match['height'],
                can_break=match['can_break']
            ))
        
        return elements
    
    def estimate_height(self, text: str, element_type: str) -> int:
        """ä¼°ç®—å…ƒç´ é«˜åº¦"""
        if element_type in ['h1', 'h2', 'h3', 'hr']:
            return self.HEIGHTS[element_type]
        
        # æ ¹æ®æ–‡å­—é•¿åº¦ä¼°ç®—
        if element_type == 'p':
            # å‡è®¾æ¯è¡Œçº¦30ä¸ªå­—ç¬¦
            lines = len(text) / 30
            return int(lines * 20 + 40)  # è¡Œé«˜20px + padding
        
        if element_type == 'li':
            lines = len(text) / 30
            return int(lines * 20 + 20)
        
        if element_type == 'blockquote':
            lines = len(text) / 28  # å¼•ç”¨é€šå¸¸å­—ç¨å¤§
            return int(lines * 22 + 60)
        
        # ä»£ç å—
        if element_type == 'pre':
            lines = text.count('\n') + 1
            return lines * self.HEIGHTS['code_line'] + 40
        
        return self.HEIGHTS.get(element_type, 60)
    
    def paginate(self, html_content: str) -> List[str]:
        """æ™ºèƒ½åˆ†é¡µ"""
        elements = self.parse_html_to_elements(html_content)
        
        if not elements:
            return [html_content]
        
        pages = []
        current_page_elements = []
        current_height = 0
        
        for i, element in enumerate(elements):
            # æ£€æŸ¥æ˜¯å¦éœ€è¦æ–°é¡µ
            if current_height + element.estimated_height > self.CONTENT_HEIGHT:
                # å¦‚æœå½“å‰é¡µä¸ä¸ºç©ºï¼Œåˆ›å»ºæ–°é¡µ
                if current_page_elements:
                    pages.append(self.combine_elements(current_page_elements))
                    current_page_elements = []
                    current_height = 0
                
                # å¦‚æœå…ƒç´ å¤ªå¤§ï¼Œå•ç‹¬æˆé¡µ
                if element.estimated_height > self.CONTENT_HEIGHT:
                    pages.append(element.content)
                    continue
            
            # æ ‡é¢˜ä¸åº”è¯¥åœ¨é¡µé¢åº•éƒ¨
            if element.element_type in ['h1', 'h2', 'h3']:
                # æ£€æŸ¥åç»­å†…å®¹
                next_height = self.get_next_section_height(elements, i)
                if current_height + element.estimated_height + next_height > self.CONTENT_HEIGHT:
                    # æ ‡é¢˜å’Œå…¶å†…å®¹ç§»åˆ°ä¸‹ä¸€é¡µ
                    if current_page_elements:
                        pages.append(self.combine_elements(current_page_elements))
                        current_page_elements = []
                        current_height = 0
            
            current_page_elements.append(element)
            current_height += element.estimated_height
        
        # æ·»åŠ æœ€åä¸€é¡µ
        if current_page_elements:
            pages.append(self.combine_elements(current_page_elements))
        
        return pages if pages else [html_content]
    
    def get_next_section_height(self, elements: List[PageElement], start_index: int) -> int:
        """è·å–æ ‡é¢˜åç»­å†…å®¹çš„é«˜åº¦ï¼ˆè‡³å°‘åŒ…å«ä¸€ä¸ªæ®µè½ï¼‰"""
        if start_index >= len(elements) - 1:
            return 0
        
        height = 0
        for i in range(start_index + 1, min(start_index + 3, len(elements))):
            if elements[i].element_type in ['h1', 'h2', 'h3']:
                break
            height += elements[i].estimated_height
            if elements[i].element_type == 'p':
                break  # è‡³å°‘åŒ…å«ä¸€ä¸ªæ®µè½
        
        return height
    
    def combine_elements(self, elements: List[PageElement]) -> str:
        """ç»„åˆå…ƒç´ ä¸ºHTML"""
        return ''.join(e.content for e in elements)
    
    def add_page_numbers(self, pages: List[str]) -> List[str]:
        """ä¸ºæ¯é¡µæ·»åŠ é¡µç """
        numbered_pages = []
        total = len(pages)
        
        for i, page in enumerate(pages, 1):
            # åœ¨é¡µé¢åº•éƒ¨æ·»åŠ é¡µç 
            page_with_number = page + f"""
            <div style="position: absolute; bottom: 20px; right: 30px; 
                        font-size: 12px; color: #999;">
                {i} / {total}
            </div>
            """
            numbered_pages.append(page_with_number)
        
        return numbered_pages
```
 ### 3. **ä½¿ç”¨æ™ºèƒ½åˆ†é¡µå™¨**

åœ¨ `preview_widget.py` ä¸­ä½¿ç”¨æ–°çš„åˆ†é¡µå™¨ï¼š

```python
# åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯¼å…¥
from src.utils.paginator import SmartPaginator

# åœ¨ PreviewWidget ç±»ä¸­
def __init__(self):
    # ... å…¶ä»–ä»£ç 
### ç”¨æˆ·:
é¡¹ç›®èƒŒæ™¯
æˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ª Windows æ¡Œé¢åº”ç”¨ã€Œå°çº¢ä¹¦ Markdown ç¼–è¾‘å™¨ã€,æ ¸å¿ƒç›®æ ‡æ˜¯:
- ç”¨æˆ·è¾“å…¥ Markdown æ–‡æœ¬
- è‡ªåŠ¨æ¸²æŸ“æˆå°çº¢ä¹¦é£æ ¼çš„ç²¾ç¾å¡ç‰‡
- æ™ºèƒ½åˆ†é¡µ(3:4 æ¯”ä¾‹,1080Ã—1440px)
- æ‰¹é‡å¯¼å‡ºé«˜è´¨é‡å›¾ç‰‡
 
# æŠ€æœ¯æ ˆ
- æ¡†æ¶:PySide6 (Qt for Python)
- æ¸²æŸ“:QWebEngineView (åŸºäº Chromium)
- Markdownè§£æ:python-markdown + æ‰©å±•
- æ ·å¼:HTML + CSS (å°çº¢ä¹¦é£æ ¼)
- åˆ†é¡µ:JavaScript (åœ¨ WebEngine ä¸­æ‰§è¡Œ)
 
# æ ¸å¿ƒæ¶æ„è®¾è®¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ä¸»çª—å£ (MainWindow)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¼–è¾‘å™¨ç»„ä»¶  â”‚   é¢„è§ˆç»„ä»¶    â”‚  å·¥å…·æ    â”‚
â”‚ (QTextEdit) â”‚(QWebEngineView)â”‚ (QToolBar)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Markdownè§£æ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTMLç”Ÿæˆ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ™ºèƒ½åˆ†é¡µ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ·å¼æ¸²æŸ“    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å›¾ç‰‡å¯¼å‡º    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 
# é¡¹ç›®ç»“æ„
xiaohongshu-editor/
â”œâ”€â”€ main.py                     # å¯åŠ¨ç¨‹åº,åˆ›å»º Qt åº”ç”¨
â”œâ”€â”€ requirements.txt            # ä¾èµ–åŒ…åˆ—è¡¨:PySide6ã€markdown ç­‰
 
src/
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ main_window.py         # ä¸»çª—å£:å·¦å³åˆ†æ å¸ƒå±€,å¯¼å‡ºæŒ‰é’®,300mså»¶è¿Ÿæ›´æ–°
â”‚   â”œâ”€â”€ editor_widget.py       # å·¦ä¾§ç¼–è¾‘å™¨:QTextEdit,å«ç¤ºä¾‹æ–‡æœ¬
â”‚   â”œâ”€â”€ preview_widget.py      # å³ä¾§é¢„è§ˆ:QWebEngineView æ˜¾ç¤º HTML
â”‚   
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ markdown_processor.py  # Markdown è½¬ HTML:ä½¿ç”¨ python-markdown åº“
â”‚   â”œâ”€â”€ html_generator.py      # ç”Ÿæˆå®Œæ•´ç½‘é¡µ:æ·»åŠ  CSS æ ·å¼(ç´«è‰²æ¸å˜èƒŒæ™¯)
â”‚   
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ paginator.py           # ï¿½ï¿½ ç©ºæ–‡ä»¶(æœªå®ç°)
â”‚   â”œâ”€â”€ exporter.py            # ï¿½ï¿½ ç©ºæ–‡ä»¶(æœªå®ç°,å¯¼å‡ºåŠŸèƒ½åœ¨ preview_widget ä¸­)
â”‚   
â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ styles/                # ï¿½ï¿½ ç©ºæ–‡ä»¶å¤¹(CSS ç›´æ¥å†™åœ¨ html_generator.py ä¸­)
â”‚   â””â”€â”€ templates/             # ï¿½ï¿½ ç©ºæ–‡ä»¶å¤¹(HTML æ¨¡æ¿ç›´æ¥å†™åœ¨ä»£ç ä¸­)
# æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚
 
## 1. æ™ºèƒ½åˆ†é¡µç®—æ³•
- æ¯é¡µå›ºå®šå°ºå¯¸:1080Ã—1440px (3:4æ¯”ä¾‹)
- åˆ†é¡µåŸåˆ™:
  * æ®µè½å®Œæ•´æ€§:ä¸åœ¨æ®µè½ä¸­é—´åˆ†é¡µ
  * æ ‡é¢˜å…³è”:æ ‡é¢˜ä¸å…¶åç»­å†…å®¹ä¿æŒåŒé¡µ
  * åˆ—è¡¨è¿ç»­:åˆ—è¡¨é¡¹å°½é‡ä¸åˆ†ç¦»
  * ä»£ç å®Œæ•´:ä»£ç å—ä¸è·¨é¡µ
  * è§†è§‰å¹³è¡¡:é¿å…é¡µé¢è¿‡ç©ºæˆ–è¿‡æ»¡
 
## 2. æ ·å¼ç³»ç»Ÿ
- é¢„è®¾ä¸»é¢˜:å°çº¢ä¹¦ã€Instagramã€å¾®ä¿¡ã€çŸ¥ä¹ç­‰
- æ ·å¼è¦ç´ :
  * å­—ä½“:ä¸­æ–‡ç”¨è‹¹æ–¹/å¾®è½¯é›…é»‘,è¥¿æ–‡ç”¨ Helvetica
  * é¢œè‰²:ä¸»è‰² #FF2442,æ–‡å­— #333333
  * é—´è·:æ®µè½é—´è· 20px,è¡Œé«˜ 1.8
  * ç‰¹æ•ˆ:å¡ç‰‡é˜´å½±ã€åœ†è§’ã€æ¸å˜èƒŒæ™¯
 
## 3. æ¸²æŸ“æµç¨‹
```python
# ä¼ªä»£ç ç¤ºä¾‹
markdown_text â†’ parse_markdown() â†’ generate_html() â†’ apply_styles() â†’ paginate() â†’ render_preview() â†’ export_images()
4. å¯¼å‡ºåŠŸèƒ½
 
æ ¼å¼:PNG/JPEG
è´¨é‡:æ”¯æŒ 1x/2x/3x åˆ†è¾¨ç‡
å‘½å:è‡ªåŠ¨ç¼–å·,å¦‚ card_01.png, card_02.png
æ‰¹é‡:ä¸€æ¬¡å¯¼å‡ºæ‰€æœ‰åˆ†é¡µ
 
ä»£ç è§„èŒƒ
 
ä½¿ç”¨ç±»å‹æ³¨è§£ (typing)
éµå¾ª PEP 8
ä¸­æ–‡æ³¨é‡Šè¯´æ˜å…³é”®é€»è¾‘
é”™è¯¯å¤„ç†è¦å®Œå–„
 
æ€§èƒ½è¦æ±‚
 
å®æ—¶é¢„è§ˆå»¶è¿Ÿ < 300ms
æ”¯æŒ 10000 å­—çš„æ–‡æ¡£
å¯¼å‡ºé€Ÿåº¦:æ¯å¼ å¡ç‰‡ < 1ç§’
 
é—®é¢˜æè¿°
ç›®å‰æˆ‘çš„ä»£ç å¯¼å‡ºå›¾ç‰‡çš„æ—¶å€™ä¼šæŠ¥é”™:å¯¼å‡ºè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:
'PySide6.QtWebEngineCore.QWebEnginePage' object has no attribute 'setViewportSize'
èƒ½å¦æŒ‰ç…§æˆ‘ä»¬çš„æ€è·¯,å®Œå–„å›¾ç‰‡å¯¼å‡ºåŠŸèƒ½?åœ¨è¿™ä¹‹å‰,è¿˜æœ‰æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿å¿˜è®°å¤„ç†?è‹¥æ²¡æœ‰å¿˜è®°,åˆ™å®Œå–„è¿™ä¸ªåŠŸèƒ½
æœŸæœ›è¾“å‡º
ä¿®æ”¹é—®é¢˜çš„ä»£ç ;è‹¥ä¿®æ”¹å°åˆ™ç›´æ¥å‘Šè¯‰æˆ‘ä½ç½®,æˆ‘ä¸ªäººè¿›è¡Œä¿®æ”¹;è‹¥å˜åŠ¨å¤§,åˆ™ç»™æˆ‘è¿™ä¸ªæ–‡ä»¶çš„å®Œæ•´ä»£ç 
editor_widget.py->text/plain-># ============================================
# src/ui/editor_widget.py
# ============================================
from PySide6.QtWidgets import QTextEdit, QVBoxLayout, QWidget, QLabel, QFrame
from PySide6.QtGui import QFont, QTextOption, QPalette, QColor
from PySide6.QtCore import Signal, Qt

class EditorWidget(QWidget):
    textChanged = Signal()
    scrollChanged = Signal(float)  # å‘é€æ»šåŠ¨ç™¾åˆ†æ¯”
    
    def __init__(self):
        super().__init__()
        self.init_ui()
        
    def init_ui(self):
        """åˆå§‹åŒ–UI"""
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)
        
        # åˆ›å»ºå®¹å™¨æ¡†æ¶
        container = QFrame()
        container.setStyleSheet("""
            QFrame {
                background: rgba(25, 25, 40, 0.95);
                border: 1px solid rgba(0, 224, 255, 0.2);
                border-radius: 16px;
            }
        """)
        container_layout = QVBoxLayout(container)
        container_layout.setContentsMargins(0, 0, 0, 0)
        container_layout.setSpacing(0)
        
        # æ ‡é¢˜æ 
        title_bar = QFrame()
        title_bar.setFixedHeight(50)
        title_bar.setStyleSheet("""
            QFrame {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 0,
                    stop: 0 rgba(0, 224, 255, 0.1),
                    stop: 0.5 rgba(0, 150, 255, 0.15),
                    stop: 1 rgba(0, 224, 255, 0.1)
                );
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
                border-bottom: 1px solid rgba(0, 224, 255, 0.2);
                padding: 12px 20px;
            }
        """)
        title_layout = QVBoxLayout(title_bar)
        
        title = QLabel("âœï¸ Markdown ç¼–è¾‘å™¨")
        title.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-size: 16px;
                font-weight: 600;
                letter-spacing: 0.5px;
            }
        """)
        title_layout.addWidget(title)
        
        # ç¼–è¾‘å™¨
        self.editor = QTextEdit()
        self.editor.setFont(QFont("Cascadia Code, Consolas, Monaco", 12))
        self.editor.setLineWrapMode(QTextEdit.WidgetWidth)
        self.editor.setWordWrapMode(QTextOption.WordWrap)
        
        # è®¾ç½®ç¼–è¾‘å™¨æ ·å¼
        self.editor.setStyleSheet("""
            QTextEdit {
                border: none;
                padding: 25px;
                background-color: rgba(15, 15, 25, 0.6);
                color: #e0e6ed;
                selection-background-color: rgba(0, 224, 255, 0.3);
                selection-color: #ffffff;
                border-bottom-left-radius: 16px;
                border-bottom-right-radius: 16px;
                font-size: 14px;
                line-height: 1.6;
            }
            QScrollBar:vertical {
                background: rgba(20, 20, 35, 0.5);
                width: 12px;
                border-radius: 6px;
                margin: 5px;
            }
            QScrollBar::handle:vertical {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.4),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
                border-radius: 6px;
                min-height: 30px;
            }
            QScrollBar::handle:vertical:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.6),
                    stop: 1 rgba(0, 150, 255, 0.5)
                );
            }
            QScrollBar::add-line:vertical,
            QScrollBar::sub-line:vertical {
                border: none;
                background: none;
                height: 0;
            }
            QScrollBar:horizontal {
                background: rgba(20, 20, 35, 0.5);
                height: 12px;
                border-radius: 6px;
                margin: 5px;
            }
            QScrollBar::handle:horizontal {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 0,
                    stop: 0 rgba(0, 224, 255, 0.4),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
                border-radius: 6px;
                min-width: 30px;
            }
            QScrollBar::handle:horizontal:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 0,
                    stop: 0 rgba(0, 224, 255, 0.6),
                    stop: 1 rgba(0, 150, 255, 0.5)
                );
            }
            QScrollBar::add-line:horizontal,
            QScrollBar::sub-line:horizontal {
                border: none;
                background: none;
                width: 0;
            }
        """)
        
        # è®¾ç½®é»˜è®¤æ–‡æœ¬
        self.editor.setPlainText("""# ğŸŒ¸ å°çº¢ä¹¦ç¬”è®°æ ‡é¢˜

## ä»Šæ—¥åˆ†äº«

å¤§å®¶å¥½å‘€ï½ä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸€ä¸ªè¶…å®ç”¨çš„ **Markdown ç¼–è¾‘å™¨**ï¼

### âœ¨ ä¸»è¦åŠŸèƒ½

1. **å®æ—¶é¢„è§ˆ** - å·¦è¾¹å†™ï¼Œå³è¾¹çœ‹
2. **æ™ºèƒ½åˆ†é¡µ** - è‡ªåŠ¨é€‚é…å°çº¢ä¹¦å¡ç‰‡å°ºå¯¸
3. **ä¸€é”®å¯¼å‡º** - æ‰¹é‡ç”Ÿæˆç²¾ç¾å›¾ç‰‡

### ğŸ“ ä½¿ç”¨æ–¹æ³•

- åœ¨å·¦ä¾§è¾“å…¥ Markdown æ–‡æœ¬
- å³ä¾§å®æ—¶æ˜¾ç¤ºé¢„è§ˆæ•ˆæœ
- ç‚¹å‡»å¯¼å‡ºæŒ‰é’®ä¿å­˜å›¾ç‰‡

> ğŸ’¡ å°è´´å£«ï¼šæ”¯æŒæ‰€æœ‰å¸¸ç”¨çš„ Markdown è¯­æ³•å“¦ï½

### ä»£ç ç¤ºä¾‹

```python
def hello():
    print("Hello, å°çº¢ä¹¦!")
    return "â¤ï¸"
```

### è¡¨æ ¼ç¤ºä¾‹

| åŠŸèƒ½ | æè¿° | çŠ¶æ€ |
|------|------|------|
| ç¼–è¾‘ | Markdownç¼–è¾‘å™¨ | âœ… |
| é¢„è§ˆ | å®æ—¶æ¸²æŸ“ | âœ… |
| å¯¼å‡º | å›¾ç‰‡ç”Ÿæˆ | âœ… |

---

å–œæ¬¢çš„è¯è®°å¾— **ç‚¹èµæ”¶è—** å“¦ï½ â¤ï¸

å…³æ³¨æˆ‘ï¼Œè·å–æ›´å¤šå®ç”¨å·¥å…·ï¼""")
        
        # è¿æ¥ä¿¡å·
        self.editor.textChanged.connect(self.textChanged.emit)
        self.editor.verticalScrollBar().valueChanged.connect(self.on_scroll)
        
        # ç»„è£…å¸ƒå±€
        container_layout.addWidget(title_bar)
        container_layout.addWidget(self.editor)
        
        layout.addWidget(container)
        
    def get_text(self):
        """è·å–ç¼–è¾‘å™¨æ–‡æœ¬"""
        return self.editor.toPlainText()
    
    def on_scroll(self):
        """å¤„ç†æ»šåŠ¨äº‹ä»¶"""
        scrollbar = self.editor.verticalScrollBar()
        if scrollbar.maximum() > 0:
            percentage = scrollbar.value() / scrollbar.maximum()
            self.scrollChanged.emit(percentage) main_window.py->text/plain-># ============================================
# src/ui/main_window.py
# ============================================
from PySide6.QtWidgets import (QMainWindow, QHBoxLayout, QVBoxLayout, 
                               QWidget, QToolBar, QSplitter, QPushButton,
                               QFileDialog, QMessageBox, QStatusBar, QLabel,
                               QGraphicsDropShadowEffect)
from PySide6.QtCore import Qt, QTimer
from PySide6.QtGui import QAction, QIcon, QColor
from src.ui.editor_widget import EditorWidget
from src.ui.preview_widget import PreviewWidget

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        
        # å…ˆåˆ›å»ºè‡ªåŠ¨æ›´æ–°è®¡æ—¶å™¨
        self.update_timer = QTimer()
        self.update_timer.timeout.connect(self.update_preview)
        self.update_timer.setInterval(300)  # 300mså»¶è¿Ÿ
        
        # ç„¶ååˆå§‹åŒ–UI
        self.init_ui()
        self.setup_connections()
        
    def init_ui(self):
        """åˆå§‹åŒ–UI"""
        self.setWindowTitle("ğŸ“ å°çº¢ä¹¦ Markdown ç¼–è¾‘å™¨")
        self.setGeometry(100, 100, 1700, 950)
        
        # è®¾ç½®çª—å£æ ·å¼ - æ·±è‰²ç§‘æŠ€é£èƒŒæ™¯
        self.setStyleSheet("""
            QMainWindow {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 1,
                    stop: 0 #0f0f1e,
                    stop: 0.5 #1a1a2e, 
                    stop: 1 #16213e
                );
            }
        """)
        
        # åˆ›å»ºå·¥å…·æ 
        toolbar = QToolBar()
        toolbar.setMovable(False)
        toolbar.setFixedHeight(65)
        toolbar.setStyleSheet("""
            QToolBar {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(30, 30, 45, 0.95),
                    stop: 1 rgba(20, 20, 35, 0.98)
                );
                border: none;
                border-bottom: 2px solid rgba(0, 224, 255, 0.3);
                padding: 10px 15px;
                spacing: 12px;
            }
            QToolButton {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.15),
                    stop: 1 rgba(0, 150, 255, 0.1)
                );
                border: 1px solid rgba(0, 224, 255, 0.4);
                border-radius: 10px;
                padding: 10px 20px;
                color: #00e0ff;
                font-weight: 600;
                font-size: 14px;
                margin: 0 5px;
                letter-spacing: 0.5px;
                min-width: 120px;
            }
            QToolButton:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.25),
                    stop: 1 rgba(0, 150, 255, 0.2)
                );
                border: 1px solid rgba(0, 224, 255, 0.6);
                color: #00f0ff;
            }
            QToolButton:pressed {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.35),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
                border: 1px solid #00e0ff;
                color: white;
            }
        """)
        self.addToolBar(toolbar)
        
        # æ·»åŠ å·¥å…·æ æŒ‰é’®
        export_action = QAction("ğŸ“¸ å¯¼å‡ºå›¾ç‰‡", self)
        export_action.triggered.connect(self.export_images)
        toolbar.addAction(export_action)
        
        toolbar.addSeparator()
        
        clear_action = QAction("ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹", self)
        clear_action.triggered.connect(self.clear_content)
        toolbar.addAction(clear_action)
        
        # åˆ›å»ºçŠ¶æ€æ 
        self.status_bar = QStatusBar()
        self.status_bar.setFixedHeight(35)
        self.status_bar.setStyleSheet("""
            QStatusBar {
                background: rgba(20, 20, 35, 0.95);
                color: #8a92a6;
                border-top: 1px solid rgba(0, 224, 255, 0.2);
                padding: 6px 15px;
                font-size: 13px;
            }
            QStatusBar::item {
                border: none;
            }
        """)
        self.setStatusBar(self.status_bar)
        
        # æ·»åŠ çŠ¶æ€æ ä¿¡æ¯
        self.char_count_label = QLabel("å­—æ•°: 0")
        self.char_count_label.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-weight: 500;
                padding: 4px 12px;
                background: rgba(0, 224, 255, 0.1);
                border: 1px solid rgba(0, 224, 255, 0.3);
                border-radius: 12px;
            }
        """)
        self.status_bar.addPermanentWidget(self.char_count_label)
        
        # åˆ›å»ºä¸­å¿ƒéƒ¨ä»¶
        central_widget = QWidget()
        central_widget.setStyleSheet("""
            QWidget {
                background: transparent;
            }
        """)
        self.setCentralWidget(central_widget)
        
        # åˆ›å»ºå¸ƒå±€
        layout = QHBoxLayout(central_widget)
        layout.setContentsMargins(25, 25, 25, 25)
        layout.setSpacing(20)
        
        # åˆ›å»ºåˆ†å‰²å™¨
        splitter = QSplitter(Qt.Horizontal)
        splitter.setStyleSheet("""
            QSplitter::handle {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.2),
                    stop: 0.5 rgba(0, 224, 255, 0.4),
                    stop: 1 rgba(0, 224, 255, 0.2)
                );
                width: 3px;
                border-radius: 1px;
            }
            QSplitter::handle:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.3),
                    stop: 0.5 rgba(0, 224, 255, 0.6),
                    stop: 1 rgba(0, 224, 255, 0.3)
                );
            }
        """)
        
        # åˆ›å»ºç¼–è¾‘å™¨å’Œé¢„è§ˆç»„ä»¶
        self.editor = EditorWidget()
        self.preview = PreviewWidget()
        
        # æ·»åŠ é˜´å½±æ•ˆæœ
        self.add_shadow_effect(self.editor)
        self.add_shadow_effect(self.preview)
        
        # æ·»åŠ åˆ°åˆ†å‰²å™¨
        splitter.addWidget(self.editor)
        splitter.addWidget(self.preview)
        splitter.setSizes([850, 850])  # è®¾ç½®åˆå§‹å®½åº¦
        
        layout.addWidget(splitter)
        
        # åˆå§‹æ›´æ–°
        self.update_preview()
        self.update_char_count()
    
    def add_shadow_effect(self, widget):
        """ä¸ºç»„ä»¶æ·»åŠ é˜´å½±æ•ˆæœ"""
        shadow = QGraphicsDropShadowEffect()
        shadow.setBlurRadius(30)
        shadow.setXOffset(0)
        shadow.setYOffset(5)
        shadow.setColor(QColor(0, 224, 255, 50))
        widget.setGraphicsEffect(shadow)
        
    def setup_connections(self):
        """è®¾ç½®ä¿¡å·è¿æ¥"""
        self.editor.textChanged.connect(self.on_text_changed)
        self.editor.scrollChanged.connect(self.preview.handle_scroll)
        self.preview.pageChanged.connect(self.on_page_changed)
        
    def on_text_changed(self):
        """æ–‡æœ¬æ”¹å˜æ—¶å¯åŠ¨è®¡æ—¶å™¨"""
        self.update_timer.stop()
        self.update_timer.start()
        self.update_char_count()
        
    def update_preview(self):
        """æ›´æ–°é¢„è§ˆ"""
        self.update_timer.stop()
        markdown_text = self.editor.get_text()
        self.preview.update_content(markdown_text)
        
    def update_char_count(self):
        """æ›´æ–°å­—æ•°ç»Ÿè®¡"""
        text = self.editor.get_text()
        char_count = len(text.replace(" ", "").replace("\n", ""))
        self.char_count_label.setText(f"å­—æ•°: {char_count}")
        
    def on_page_changed(self, current, total):
        """é¡µç æ”¹å˜æ—¶æ›´æ–°çŠ¶æ€æ """
        self.status_bar.showMessage(f"é¡µé¢: {current}/{total}", 2000)
        
    def clear_content(self):
        """æ¸…ç©ºå†…å®¹"""
        reply = QMessageBox.question(
            self, "ç¡®è®¤æ¸…ç©º",
            "ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ",
            QMessageBox.Yes | QMessageBox.No,
            QMessageBox.No
        )
        
        if reply == QMessageBox.Yes:
            self.editor.editor.clear()
            
    def export_images(self):
        """å¯¼å‡ºå›¾ç‰‡"""
        folder = QFileDialog.getExistingDirectory(self, "é€‰æ‹©å¯¼å‡ºæ–‡ä»¶å¤¹")
        if folder:
            try:
                self.preview.export_pages(folder)
                QMessageBox.information(
                    self, "å¯¼å‡ºæˆåŠŸ",
                    f"å›¾ç‰‡å·²æˆåŠŸå¯¼å‡ºåˆ°:\n{folder}",
                    QMessageBox.Ok
                )
            except Exception as e:
                QMessageBox.critical(
                    self, "å¯¼å‡ºå¤±è´¥",
                    f"å¯¼å‡ºè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:\n{str(e)}",
                    QMessageBox.Ok
                ) preview_widget.py->text/plain-># ============================================
# src/ui/preview_widget.py
# ============================================
from PySide6.QtWidgets import QWidget, QVBoxLayout, QLabel, QFrame, QPushButton, QHBoxLayout
from PySide6.QtWebEngineWidgets import QWebEngineView
from PySide6.QtCore import QUrl, QTimer, Signal, Qt
from PySide6.QtGui import QImage, QPainter
import os
from pathlib import Path
from src.core.markdown_processor import MarkdownProcessor
from src.core.html_generator import HTMLGenerator

class PreviewWidget(QWidget):
    pageChanged = Signal(int, int)  # å½“å‰é¡µï¼Œæ€»é¡µæ•°
    
    def __init__(self):
        super().__init__()
        self.current_pages = []
        self.current_page = 1
        self.total_pages = 1
        self.init_ui()
        
    def init_ui(self):
        """åˆå§‹åŒ–UI"""
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)
        
        # åˆ›å»ºå®¹å™¨æ¡†æ¶
        container = QFrame()
        container.setStyleSheet("""
            QFrame {
                background: rgba(25, 25, 40, 0.95);
                border: 1px solid rgba(0, 224, 255, 0.2);
                border-radius: 16px;
            }
        """)
        container_layout = QVBoxLayout(container)
        container_layout.setContentsMargins(0, 0, 0, 0)
        container_layout.setSpacing(0)
        
        # æ ‡é¢˜æ 
        title_bar = QFrame()
        title_bar.setFixedHeight(50)
        title_bar.setStyleSheet("""
            QFrame {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 0,
                    stop: 0 rgba(0, 224, 255, 0.1),
                    stop: 0.5 rgba(0, 150, 255, 0.15),
                    stop: 1 rgba(0, 224, 255, 0.1)
                );
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
                border-bottom: 1px solid rgba(0, 224, 255, 0.2);
                padding: 12px 20px;
            }
        """)
        title_layout = QHBoxLayout(title_bar)
        
        title = QLabel("ğŸ‘€ å®æ—¶é¢„è§ˆ")
        title.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-size: 16px;
                font-weight: 600;
                letter-spacing: 0.5px;
            }
        """)
        
        # é¡µç æ˜¾ç¤º
        self.page_label = QLabel("ç¬¬ 1/1 é¡µ")
        self.page_label.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-size: 13px;
                font-weight: 500;
                padding: 5px 15px;
                background: rgba(0, 224, 255, 0.1);
                border: 1px solid rgba(0, 224, 255, 0.3);
                border-radius: 15px;
            }
        """)
        
        title_layout.addWidget(title)
        title_layout.addStretch()
        title_layout.addWidget(self.page_label)
        
        # Webè§†å›¾
        self.web_view = QWebEngineView()
        self.web_view.setStyleSheet("""
            QWebEngineView {
                border: none;
                background: rgba(15, 15, 25, 0.6);
            }
        """)
        
        # ç¿»é¡µæ§åˆ¶æ 
        control_bar = QFrame()
        control_bar.setFixedHeight(60)
        control_bar.setStyleSheet("""
            QFrame {
                background: rgba(20, 20, 35, 0.8);
                padding: 10px 20px;
                border-bottom-left-radius: 16px;
                border-bottom-right-radius: 16px;
                border-top: 1px solid rgba(0, 224, 255, 0.1);
            }
        """)
        control_layout = QHBoxLayout(control_bar)
        
        self.prev_btn = QPushButton("â¬… ä¸Šä¸€é¡µ")
        self.prev_btn.setFixedSize(120, 36)
        self.prev_btn.setStyleSheet("""
            QPushButton {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.15),
                    stop: 1 rgba(0, 150, 255, 0.1)
                );
                border: 1px solid rgba(0, 224, 255, 0.4);
                color: #00e0ff;
                padding: 8px 16px;
                border-radius: 8px;
                font-weight: 600;
                font-size: 13px;
            }
            QPushButton:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.25),
                    stop: 1 rgba(0, 150, 255, 0.2)
                );
                border: 1px solid rgba(0, 224, 255, 0.6);
            }
            QPushButton:pressed {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.35),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
            }
            QPushButton:disabled {
                background: rgba(30, 30, 45, 0.5);
                border-color: rgba(100, 100, 120, 0.3);
                color: rgba(100, 100, 120, 0.5);
            }
        """)
        
        self.next_btn = QPushButton("ä¸‹ä¸€é¡µ â¡")
        self.next_btn.setFixedSize(120, 36)
        self.next_btn.setStyleSheet("""
            QPushButton {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.15),
                    stop: 1 rgba(0, 150, 255, 0.1)
                );
                border: 1px solid rgba(0, 224, 255, 0.4);
                color: #00e0ff;
                padding: 8px 16px;
                border-radius: 8px;
                font-weight: 600;
                font-size: 13px;
            }
            QPushButton:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.25),
                    stop: 1 rgba(0, 150, 255, 0.2)
                );
                border: 1px solid rgba(0, 224, 255, 0.6);
            }
            QPushButton:pressed {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.35),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
            }
            QPushButton:disabled {
                background: rgba(30, 30, 45, 0.5);
                border-color: rgba(100, 100, 120, 0.3);
                color: rgba(100, 100, 120, 0.5);
            }
        """)
        
        control_layout.addWidget(self.prev_btn)
        control_layout.addStretch()
        control_layout.addWidget(self.next_btn)
        
        # ç»„è£…å¸ƒå±€
        container_layout.addWidget(title_bar)
        container_layout.addWidget(self.web_view, 1)
        container_layout.addWidget(control_bar)
        
        layout.addWidget(container)
        
        # å¤„ç†å™¨
        self.markdown_processor = MarkdownProcessor()
        self.html_generator = HTMLGenerator()
        
        # è¿æ¥ä¿¡å·
        self.prev_btn.clicked.connect(self.prev_page)
        self.next_btn.clicked.connect(self.next_page)
        
        # åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
        self.update_buttons()
        
    def update_content(self, markdown_text: str):
        """æ›´æ–°é¢„è§ˆå†…å®¹"""
        try:
            # å¤„ç† Markdown
            html_content = self.markdown_processor.parse(markdown_text)
            
            # ç”Ÿæˆå®Œæ•´HTML
            full_html = self.html_generator.generate(html_content)
            
            # åŠ è½½åˆ°WebView
            self.web_view.setHtml(full_html, QUrl("file:///"))
            
            # ä¿å­˜å½“å‰é¡µé¢ï¼ˆç”¨äºå¯¼å‡ºï¼‰
            self.current_html = full_html
            
            # æ›´æ–°é¡µç æ˜¾ç¤º
            self.update_page_info()
            
        except Exception as e:
            error_html = f"""
            <html>
            <body style="padding: 20px; font-family: sans-serif; background: #1a1a2e; color: #e0e6ed;">
                <h3 style="color: #ff4757;">é¢„è§ˆé”™è¯¯</h3>
                <p style="color: #8a92a6;">{str(e)}</p>
            </body>
            </html>
            """
            self.web_view.setHtml(error_html)
    
    def prev_page(self):
        """ä¸Šä¸€é¡µ"""
        if self.current_page > 1:
            self.current_page -= 1
            self.update_page_display()
            self.update_buttons()
    
    def next_page(self):
        """ä¸‹ä¸€é¡µ"""
        if self.current_page < self.total_pages:
            self.current_page += 1
            self.update_page_display()
            self.update_buttons()
    
    def update_page_display(self):
        """æ›´æ–°é¡µé¢æ˜¾ç¤ºï¼ˆé¢„ç•™æ¥å£ï¼‰"""
        # è¿™é‡Œå¯ä»¥å®ç°çœŸæ­£çš„åˆ†é¡µé€»è¾‘
        pass
    
    def update_buttons(self):
        """æ›´æ–°æŒ‰é’®çŠ¶æ€"""
        self.prev_btn.setEnabled(self.current_page > 1)
        self.next_btn.setEnabled(self.current_page < self.total_pages)
    
    def update_page_info(self):
        """æ›´æ–°é¡µç ä¿¡æ¯"""
        self.page_label.setText(f"ç¬¬ {self.current_page}/{self.total_pages} é¡µ")
        self.pageChanged.emit(self.current_page, self.total_pages)
    
    def export_pages(self, folder: str):
        """å¯¼å‡ºé¡µé¢ä¸ºå›¾ç‰‡"""
        page = self.web_view.page()
        
        # è®¾ç½®é¡µé¢å¤§å°ä¸ºå°çº¢ä¹¦å¡ç‰‡å°ºå¯¸ï¼ˆ1080x1440ï¼‰
        page.setViewportSize(page.contentsSize().toSize())
        
        # åˆ›å»ºä¿å­˜è·¯å¾„
        save_path = Path(folder) / f"card_{self.current_page:02d}.png"
        
        # æˆªå›¾å¹¶ä¿å­˜
        def save_screenshot(pixmap):
            # åˆ›å»ºå°çº¢ä¹¦å°ºå¯¸çš„å›¾ç‰‡
            target_image = QImage(1080, 1440, QImage.Format_ARGB32)
            target_image.fill(Qt.white)
            
            # ç»˜åˆ¶å†…å®¹
            painter = QPainter(target_image)
            scaled_pixmap = pixmap.scaled(
                1080, 1440,
                Qt.KeepAspectRatio,
                Qt.SmoothTransformation
            )
            
            # å±…ä¸­ç»˜åˆ¶
            x = (1080 - scaled_pixmap.width()) // 2
            y = (1440 - scaled_pixmap.height()) // 2
            painter.drawPixmap(x, y, scaled_pixmap)
            painter.end()
            
            # ä¿å­˜
            target_image.save(str(save_path), "PNG", 100)
            
        page.grabToImage(save_screenshot)
    
    def handle_scroll(self, percentage: float):
        """å¤„ç†ç¼–è¾‘å™¨æ»šåŠ¨åŒæ­¥"""
        # é€šè¿‡JavaScriptåŒæ­¥æ»šåŠ¨
        script = f"""
        var content = document.getElementById('content');
        if (content) {{
            content.scrollTop = content.scrollHeight * {percentage};
        }}
        """
        self.web_view.page().runJavaScript(script) html_generator.py->text/plain-># ============================================
# src/core/html_generator.py
# ============================================
from pathlib import Path

class HTMLGenerator:
    def __init__(self):
        self.resource_path = Path(__file__).parent.parent / "resources"
        
    def generate(self, content: str) -> str:
        """ç”Ÿæˆå®Œæ•´çš„ HTML é¡µé¢"""
        css = self.get_css()
        js = self.get_js()
        
        html = f"""
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çº¢ä¹¦å¡ç‰‡</title>
    <style>{css}</style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="content" id="content">
                {content}
            </div>
            <div class="watermark">
                <span>ğŸ“ å°çº¢ä¹¦ç¬”è®°</span>
            </div>
        </div>
    </div>
    <script>{js}</script>
</body>
</html>
"""
        return html
        
    def get_css(self) -> str:
        """è·å–ä¼˜åŒ–åçš„CSSæ ·å¼"""
        return """
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", 
                        "Helvetica Neue", "Hiragino Sans GB", "Microsoft YaHei UI",
                        "Microsoft YaHei", Arial, sans-serif;
            background: linear-gradient(135deg, #ffeef8 0%, #ffe0f0 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            width: 100%;
            max-width: 650px;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(255, 36, 66, 0.08),
                        0 2px 10px rgba(0, 0, 0, 0.06);
            overflow: hidden;
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(255, 36, 66, 0.12),
                        0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .content {
            padding: 45px 40px;
            color: #2c3e50;
            line-height: 1.8;
            min-height: 450px;
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            color: #FF2442;
            font-size: 30px;
            margin-bottom: 25px;
            font-weight: 700;
            letter-spacing: -0.5px;
            border-bottom: 3px solid #FFE4E4;
            padding-bottom: 15px;
        }
        
        h2 {
            color: #FF2442;
            font-size: 24px;
            margin-top: 35px;
            margin-bottom: 20px;
            font-weight: 600;
            position: relative;
            padding-left: 18px;
        }
        
        h2::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 5px;
            height: 22px;
            background: linear-gradient(180deg, #FF2442, #FF6B6B);
            border-radius: 3px;
        }
        
        h3 {
            color: #34495e;
            font-size: 20px;
            margin-top: 28px;
            margin-bottom: 16px;
            font-weight: 600;
        }
        
        /* æ®µè½æ ·å¼ */
        p {
            margin-bottom: 20px;
            font-size: 16px;
            color: #4a5568;
            text-align: justify;
        }
        
        /* å¼ºè°ƒæ ·å¼ */
        strong {
            color: #FF2442;
            font-weight: 600;
            background: linear-gradient(180deg, transparent 70%, #FFE4E4 70%);
            padding: 0 3px;
        }
        
        em {
            font-style: italic;
            color: #718096;
        }
        
        /* åˆ—è¡¨æ ·å¼ */
        ul, ol {
            margin: 22px 0;
            padding-left: 35px;
        }
        
        li {
            margin-bottom: 14px;
            font-size: 16px;
            color: #4a5568;
            line-height: 1.8;
        }
        
        ul li::marker {
            color: #FF2442;
            font-size: 18px;
        }
        
        ol li::marker {
            color: #FF2442;
            font-weight: 600;
        }
        
        /* å¼•ç”¨æ ·å¼ */
        blockquote {
            border-left: 4px solid #FF2442;
            margin: 26px 0;
            padding: 18px 26px;
            background: linear-gradient(90deg, #FFF8F8 0%, #FFFFFF 100%);
            border-radius: 10px;
            position: relative;
        }
        
        blockquote::before {
            content: '"';
            position: absolute;
            top: -8px;
            left: 22px;
            font-size: 45px;
            color: #FFE4E4;
            font-family: Georgia, serif;
        }
        
        blockquote p {
            color: #6b7280;
            font-style: italic;
            margin-bottom: 0;
        }
        
        /* è¡Œå†…ä»£ç  */
        code {
            background: #FFF5F5;
            padding: 4px 10px;
            border-radius: 6px;
            font-family: "JetBrains Mono", "Cascadia Code", "Consolas", "Monaco", monospace;
            font-size: 14px;
            color: #e53e3e;
            font-weight: 500;
        }
        
        /* ä»£ç å— */
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 24px;
            border-radius: 12px;
            overflow-x: auto;
            margin: 26px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            position: relative;
        }
        
        pre::before {
            content: "CODE";
            position: absolute;
            top: 10px;
            right: 14px;
            font-size: 11px;
            color: #6b7280;
            font-weight: 600;
            letter-spacing: 1px;
            opacity: 0.5;
        }
        
        pre code {
            background: none;
            color: #d4d4d4;
            padding: 0;
            font-size: 14px;
            line-height: 1.7;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 26px 0;
            font-size: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
            border-radius: 10px;
            overflow: hidden;
        }
        
        th {
            background: linear-gradient(135deg, #FF2442, #FF6B6B);
            color: white;
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 15px;
        }
        
        td {
            padding: 14px 18px;
            border-bottom: 1px solid #f0f0f0;
            color: #4a5568;
        }
        
        tr:nth-child(even) {
            background: #FAFAFA;
        }
        
        tr:hover {
            background: #FFF5F5;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        /* åˆ†éš”çº¿ */
        hr {
            border: none;
            height: 1px;
            background: linear-gradient(90deg, transparent, #FFE4E4 20%, #FFE4E4 80%, transparent);
            margin: 35px 0;
        }
        
        /* é“¾æ¥æ ·å¼ */
        a {
            color: #FF2442;
            text-decoration: none;
            border-bottom: 1px solid #FFD0D7;
            transition: all 0.3s ease;
            padding-bottom: 1px;
        }
        
        a:hover {
            color: #FF6B6B;
            border-bottom-color: #FF6B6B;
            background: #FFF5F5;
            padding: 0 3px;
            margin: 0 -3px;
            border-radius: 3px;
        }
        
        /* æ°´å°æ ·å¼ */
        .watermark {
            position: absolute;
            bottom: 22px;
            right: 25px;
            font-size: 13px;
            color: #CBD5E0;
            opacity: 0.5;
            font-weight: 500;
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f5f5f5;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #FF6B6B, #FF2442);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #FF2442, #FF1030);
        }
        """
    
    def get_js(self) -> str:
        """è·å–JavaScriptä»£ç """
        return """
        // ç›‘å¬ç¼–è¾‘å™¨æ»šåŠ¨äº‹ä»¶ï¼ˆé€šè¿‡postMessageï¼‰
        window.addEventListener('message', function(e) {
            if (e.data.type === 'scroll') {
                const content = document.getElementById('content');
                const scrollPercentage = e.data.percentage;
                content.scrollTop = content.scrollHeight * scrollPercentage;
            }
        });
        """ markdown_processor.py->text/plain-># ============================================
# src/core/markdown_processor.py
# ============================================
import markdown
from markdown.extensions import fenced_code, tables

class MarkdownProcessor:
    def __init__(self):
        # åªä½¿ç”¨å¿…è¦ä¸”ç¨³å®šçš„æ‰©å±•
        self.extensions = [
            'markdown.extensions.fenced_code',  # ä»£ç å—
            'markdown.extensions.tables',       # è¡¨æ ¼
            'markdown.extensions.nl2br',        # æ¢è¡Œè½¬<br>
            'markdown.extensions.attr_list',    # å±æ€§åˆ—è¡¨
            'markdown.extensions.def_list',     # å®šä¹‰åˆ—è¡¨
            'markdown.extensions.footnotes',    # è„šæ³¨
            'markdown.extensions.toc',          # ç›®å½•
            'markdown.extensions.sane_lists',   # æ”¹è¿›çš„åˆ—è¡¨
            'markdown.extensions.smarty',       # æ™ºèƒ½æ ‡ç‚¹
        ]
        
        # é…ç½®æ‰©å±•ï¼ˆç§»é™¤ä¸æ”¯æŒçš„ css_class å‚æ•°ï¼‰
        self.extension_configs = {}
        
    def parse(self, text: str) -> str:
        """è§£æ Markdown æ–‡æœ¬ä¸º HTML"""
        try:
            # åˆ›å»ºæ–°çš„ Markdown å®ä¾‹ï¼ˆé¿å…çŠ¶æ€æ±¡æŸ“ï¼‰
            md = markdown.Markdown(
                extensions=self.extensions,
                extension_configs=self.extension_configs
            )
            
            # è½¬æ¢ Markdown ä¸º HTML
            html = md.convert(text)
            
            # åå¤„ç†ï¼šæ·»åŠ å°çº¢ä¹¦ç‰¹è‰² emoji æ”¯æŒ
            html = self._process_emojis(html)
            
            return html
            
        except Exception as e:
            print(f"Markdown è§£æé”™è¯¯: {e}")
            return f"<p style='color: red;'>è§£æé”™è¯¯: {str(e)}</p>"
    
    def _process_emojis(self, html: str) -> str:
        """å¤„ç† emoji è¡¨æƒ…"""
        # ä¿æŒ emoji åŸæ ·æ˜¾ç¤º
        return html style_manager.py->text/plain->
### ç³»ç»Ÿ:
çœ‹äº†ä½ çš„ä»£ç ï¼Œé—®é¢˜å‡ºåœ¨ `preview_widget.py` çš„å¯¼å‡ºåŠŸèƒ½ä¸Šã€‚`QWebEnginePage` åœ¨ PySide6 ä¸­ç¡®å®æ²¡æœ‰ `setViewportSize` æ–¹æ³•ï¼Œè¿™æ˜¯ Qt5 çš„æ—§APIã€‚

åœ¨å®Œå–„å¯¼å‡ºåŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘å‘ç°äº†å‡ ä¸ªéœ€è¦å…ˆå¤„ç†çš„é—®é¢˜ï¼š

## 1. **ç¼ºå¤±çš„å…³é”®åŠŸèƒ½ï¼šæ™ºèƒ½åˆ†é¡µ**
ç›®å‰ä»£ç ä¸­æ²¡æœ‰å®ç°çœŸæ­£çš„åˆ†é¡µé€»è¾‘ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†é¡µç æ˜¾ç¤ºã€‚è¿™æ˜¯æ ¸å¿ƒåŠŸèƒ½ï¼Œéœ€è¦å…ˆå®ç°ã€‚

## 2. **å¯¼å‡ºåŠŸèƒ½çš„é—®é¢˜**
- `QWebEnginePage` æ²¡æœ‰ `setViewportSize` æ–¹æ³•
- `grabToImage` æ–¹æ³•ç­¾åä¸æ­£ç¡®
- ç¼ºå°‘æ‰¹é‡å¯¼å‡ºå¤šé¡µçš„é€»è¾‘

## 3. **æ»šåŠ¨åŒæ­¥é—®é¢˜**
`handle_scroll` æ–¹æ³•ä½¿ç”¨äº† `runJavaScript`ï¼Œä½†HTMLä¸­æ²¡æœ‰å¯¹åº”çš„æ¶ˆæ¯å¤„ç†æœºåˆ¶ã€‚

è®©æˆ‘å…ˆä¿®å¤å¯¼å‡ºåŠŸèƒ½ï¼Œç„¶åå®ç°å®Œæ•´çš„åˆ†é¡µç³»ç»Ÿï¼š ä»£ç 
```python
# ============================================
# src/ui/preview_widget.py
# ============================================
from PySide6.QtWidgets import QWidget, QVBoxLayout, QLabel, QFrame, QPushButton, QHBoxLayout, QProgressDialog
from PySide6.QtWebEngineWidgets import QWebEngineView
from PySide6.QtCore import QUrl, QTimer, Signal, Qt, QSize, Slot
from PySide6.QtGui import QImage, QPainter, QPageSize
from PySide6.QtPrintSupport import QPrinter
import os
import json
from pathlib import Path
from src.core.markdown_processor import MarkdownProcessor
from src.core.html_generator import HTMLGenerator

class PreviewWidget(QWidget):
    pageChanged = Signal(int, int)  # å½“å‰é¡µï¼Œæ€»é¡µæ•°
    
    def __init__(self):
        super().__init__()
        self.current_pages = []  # å­˜å‚¨åˆ†é¡µåçš„HTMLå†…å®¹
        self.current_page = 1
        self.total_pages = 1
        self.markdown_text = ""  # ä¿å­˜åŸå§‹markdownæ–‡æœ¬
        self.init_ui()
        
    def init_ui(self):
        """åˆå§‹åŒ–UI"""
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)
        
        # åˆ›å»ºå®¹å™¨æ¡†æ¶
        container = QFrame()
        container.setStyleSheet("""
            QFrame {
                background: rgba(25, 25, 40, 0.95);
                border: 1px solid rgba(0, 224, 255, 0.2);
                border-radius: 16px;
            }
        """)
        container_layout = QVBoxLayout(container)
        container_layout.setContentsMargins(0, 0, 0, 0)
        container_layout.setSpacing(0)
        
        # æ ‡é¢˜æ 
        title_bar = QFrame()
        title_bar.setFixedHeight(50)
        title_bar.setStyleSheet("""
            QFrame {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 0,
                    stop: 0 rgba(0, 224, 255, 0.1),
                    stop: 0.5 rgba(0, 150, 255, 0.15),
                    stop: 1 rgba(0, 224, 255, 0.1)
                );
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
                border-bottom: 1px solid rgba(0, 224, 255, 0.2);
                padding: 12px 20px;
            }
        """)
        title_layout = QHBoxLayout(title_bar)
        
        title = QLabel("ğŸ‘€ å®æ—¶é¢„è§ˆ")
        title.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-size: 16px;
                font-weight: 600;
                letter-spacing: 0.5px;
            }
        """)
        
        # é¡µç æ˜¾ç¤º
        self.page_label = QLabel("ç¬¬ 1/1 é¡µ")
        self.page_label.setStyleSheet("""
            QLabel {
                color: #00e0ff;
                font-size: 13px;
                font-weight: 500;
                padding: 5px 15px;
                background: rgba(0, 224, 255, 0.1);
                border: 1px solid rgba(0, 224, 255, 0.3);
                border-radius: 15px;
            }
        """)
        
        title_layout.addWidget(title)
        title_layout.addStretch()
        title_layout.addWidget(self.page_label)
        
        # Webè§†å›¾
        self.web_view = QWebEngineView()
        self.web_view.setStyleSheet("""
            QWebEngineView {
                border: none;
                background: rgba(15, 15, 25, 0.6);
            }
        """)
        
        # ç¿»é¡µæ§åˆ¶æ 
        control_bar = QFrame()
        control_bar.setFixedHeight(60)
        control_bar.setStyleSheet("""
            QFrame {
                background: rgba(20, 20, 35, 0.8);
                padding: 10px 20px;
                border-bottom-left-radius: 16px;
                border-bottom-right-radius: 16px;
                border-top: 1px solid rgba(0, 224, 255, 0.1);
            }
        """)
        control_layout = QHBoxLayout(control_bar)
        
        self.prev_btn = QPushButton("â¬… ä¸Šä¸€é¡µ")
        self.prev_btn.setFixedSize(120, 36)
        self.prev_btn.setStyleSheet("""
            QPushButton {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.15),
                    stop: 1 rgba(0, 150, 255, 0.1)
                );
                border: 1px solid rgba(0, 224, 255, 0.4);
                color: #00e0ff;
                padding: 8px 16px;
                border-radius: 8px;
                font-weight: 600;
                font-size: 13px;
            }
            QPushButton:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.25),
                    stop: 1 rgba(0, 150, 255, 0.2)
                );
                border: 1px solid rgba(0, 224, 255, 0.6);
            }
            QPushButton:pressed {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.35),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
            }
            QPushButton:disabled {
                background: rgba(30, 30, 45, 0.5);
                border-color: rgba(100, 100, 120, 0.3);
                color: rgba(100, 100, 120, 0.5);
            }
        """)
        
        self.next_btn = QPushButton("ä¸‹ä¸€é¡µ â¡")
        self.next_btn.setFixedSize(120, 36)
        self.next_btn.setStyleSheet("""
            QPushButton {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.15),
                    stop: 1 rgba(0, 150, 255, 0.1)
                );
                border: 1px solid rgba(0, 224, 255, 0.4);
                color: #00e0ff;
                padding: 8px 16px;
                border-radius: 8px;
                font-weight: 600;
                font-size: 13px;
            }
            QPushButton:hover {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.25),
                    stop: 1 rgba(0, 150, 255, 0.2)
                );
                border: 1px solid rgba(0, 224, 255, 0.6);
            }
            QPushButton:pressed {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 0, y2: 1,
                    stop: 0 rgba(0, 224, 255, 0.35),
                    stop: 1 rgba(0, 150, 255, 0.3)
                );
            }
            QPushButton:disabled {
                background: rgba(30, 30, 45, 0.5);
                border-color: rgba(100, 100, 120, 0.3);
                color: rgba(100, 100, 120, 0.5);
            }
        """)
        
        control_layout.addWidget(self.prev_btn)
        control_layout.addStretch()
        control_layout.addWidget(self.next_btn)
        
        # ç»„è£…å¸ƒå±€
        container_layout.addWidget(title_bar)
        container_layout.addWidget(self.web_view, 1)
        container_layout.addWidget(control_bar)
        
        layout.addWidget(container)
        
        # å¤„ç†å™¨
        self.markdown_processor = MarkdownProcessor()
        self.html_generator = HTMLGenerator()
        
        # è¿æ¥ä¿¡å·
        self.prev_btn.clicked.connect(self.prev_page)
        self.next_btn.clicked.connect(self.next_page)
        
        # åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
        self.update_buttons()
        
    def update_content(self, markdown_text: str):
        """æ›´æ–°é¢„è§ˆå†…å®¹"""
        try:
            self.markdown_text = markdown_text
            
            # å¤„ç† Markdown
            html_content = self.markdown_processor.parse(markdown_text)
            
            # æ‰§è¡Œæ™ºèƒ½åˆ†é¡µ
            self.current_pages = self.smart_paginate(html_content)
            self.total_pages = len(self.current_pages)
            self.current_page = 1
            
            # æ˜¾ç¤ºç¬¬ä¸€é¡µ
            self.display_current_page()
            
            # æ›´æ–°æŒ‰é’®å’Œé¡µç 
            self.update_buttons()
            self.update_page_info()
            
        except Exception as e:
            error_html = f"""
            <html>
            <body style="padding: 20px; font-family: sans-serif; background: #1a1a2e; color: #e0e6ed;">
                <h3 style="color: #ff4757;">é¢„è§ˆé”™è¯¯</h3>
                <p style="color: #8a92a6;">{str(e)}</p>
            </body>
            </html>
            """
            self.web_view.setHtml(error_html)
    
    def smart_paginate(self, html_content: str) -> list:
        """
        æ™ºèƒ½åˆ†é¡µç®—æ³•
        å°†HTMLå†…å®¹åˆ†å‰²æˆé€‚åˆå°çº¢ä¹¦å¡ç‰‡çš„å¤šä¸ªé¡µé¢
        """
        # å¦‚æœå†…å®¹å¾ˆçŸ­ï¼Œç›´æ¥è¿”å›å•é¡µ
        if len(html_content) < 500:
            return [html_content]
        
        # ç®€å•çš„åˆ†é¡µç­–ç•¥ï¼šæŒ‰æ®µè½åˆ†é¡µ
        # TODO: å®ç°æ›´æ™ºèƒ½çš„åˆ†é¡µç®—æ³•
        pages = []
        
        # å°†HTMLæŒ‰æ®µè½æ‹†åˆ†
        paragraphs = html_content.split('</p>')
        current_page = ""
        current_height = 0
        max_height = 800  # ä¼°ç®—çš„æœ€å¤§é«˜åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
        
        for para in paragraphs:
            if not para.strip():
                continue
                
            para_with_tag = para + '</p>'
            para_height = len(para_with_tag)
            
            # å¦‚æœå½“å‰é¡µåŠ ä¸Šè¿™ä¸ªæ®µè½ä¸ä¼šè¶…å‡ºé™åˆ¶
            if current_height + para_height < max_height:
                current_page += para_with_tag
                current_height += para_height
            else:
                # ä¿å­˜å½“å‰é¡µå¹¶å¼€å§‹æ–°é¡µ
                if current_page:
                    pages.append(current_page)
                current_page = para_with_tag
                current_height = para_height
        
        # æ·»åŠ æœ€åä¸€é¡µ
        if current_page:
            pages.append(current_page)
        
        # å¦‚æœæ²¡æœ‰æˆåŠŸåˆ†é¡µï¼Œè¿”å›åŸå§‹å†…å®¹
        return pages if pages else [html_content]
    
    def display_current_page(self):
        """æ˜¾ç¤ºå½“å‰é¡µ"""
        if self.current_pages and 1 <= self.current_page <= len(self.current_pages):
            page_content = self.current_pages[self.current_page - 1]
            
            # æ·»åŠ é¡µç æ°´å°
            page_info = f'<div class="page-info">ç¬¬ {self.current_page}/{self.total_pages} é¡µ</div>'
            full_content = page_content + page_info
            
            # ç”Ÿæˆå®Œæ•´HTML
            full_html = self.html_generator.generate(full_content)
            
            # åŠ è½½åˆ°WebView
            self.web_view.setHtml(full_html, QUrl("file:///"))
    
    def prev_page(self):
        """ä¸Šä¸€é¡µ"""
        if self.current_page > 1:
            self.current_page -= 1
            self.display_current_page()
            self.update_buttons()
            self.update_page_info()
    
    def next_page(self):
        """ä¸‹ä¸€é¡µ"""
        if self.current_page < self.total_pages:
            self.current_page += 1
            self.display_current_page()
            self.update_buttons()
            self.update_page_info()
    
    def update_buttons(self):
        """æ›´æ–°æŒ‰é’®çŠ¶æ€"""
        self.prev_btn.setEnabled(self.current_page > 1)
        self.next_btn.setEnabled(self.current_page < self.total_pages)
    
    def update_page_info(self):
        """æ›´æ–°é¡µç ä¿¡æ¯"""
        self.page_label.setText(f"ç¬¬ {self.current_page}/{self.total_pages} é¡µ")
        self.pageChanged.emit(self.current_page, self.total_pages)
    
    def export_pages(self, folder: str):
        """å¯¼å‡ºæ‰€æœ‰é¡µé¢ä¸ºå›¾ç‰‡"""
        if not self.current_pages:
            return
            
        # åˆ›å»ºè¿›åº¦å¯¹è¯æ¡†
        progress = QProgressDialog("æ­£åœ¨å¯¼å‡ºå›¾ç‰‡...", "å–æ¶ˆ", 0, self.total_pages, self)
        progress.setWindowModality(Qt.WindowModal)
        progress.setMinimumDuration(0)
        
        # ä¿å­˜å½“å‰é¡µç 
        original_page = self.current_page
        
        try:
            for i in range(1, self.total_pages + 1):
                if progress.wasCanceled():
                    break
                    
                # æ›´æ–°è¿›åº¦
                progress.setValue(i - 1)
                progress.setLabelText(f"æ­£åœ¨å¯¼å‡ºç¬¬ {i}/{self.total_pages} é¡µ...")
                
                # åˆ‡æ¢åˆ°è¦å¯¼å‡ºçš„é¡µé¢
                self.current_page = i
                self.display_current_page()
                
                # ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
                QTimer.singleShot(500, lambda: None)  # ç»™é¡µé¢æ¸²æŸ“ä¸€äº›æ—¶é—´
                
                # å¯¼å‡ºå½“å‰é¡µ
                save_path = Path(folder) / f"card_{i:02d}.png"
                self.export_current_page(str(save_path))
                
            progress.setValue(self.total_pages)
            
        finally:
            # æ¢å¤åŸå§‹é¡µé¢
            self.current_page = original_page
            self.display_current_page()
            progress.close()
    
    def export_current_page(self, save_path: str):
        """å¯¼å‡ºå½“å‰é¡µé¢ä¸ºå›¾ç‰‡ï¼ˆä½¿ç”¨PDFä¸­é—´æ ¼å¼ï¼‰"""
        # åˆ›å»ºPDFæ‰“å°æœº
        printer = QPrinter()
        printer.setOutputFormat(QPrinter.PdfFormat)
        printer.setPageSize(QPageSize(QSize(1080, 1440), QPageSize.Point))
        printer.setPageMargins(0, 0, 0, 0, QPrinter.Millimeter)
        
        # è®¾ç½®ä¸´æ—¶PDFè·¯å¾„
        temp_pdf = save_path.replace('.png', '.pdf')
        printer.setOutputFileName(temp_pdf)
        
        # å®šä¹‰å›è°ƒå‡½æ•°æ¥å¤„ç†æ‰“å°å®Œæˆ
        def on_print_finished(success):
            if success:
                # å°†PDFè½¬æ¢ä¸ºå›¾ç‰‡
                self.pdf_to_image(temp_pdf, save_path)
                # åˆ é™¤ä¸´æ—¶PDF
                try:
                    os.remove(temp_pdf)
                except:
                    pass
        
        # æ‰“å°é¡µé¢åˆ°PDF
        self.web_view.page().print(printer, on_print_finished)
    
    def pdf_to_image(self, pdf_path: str, image_path: str):
        """å°†PDFè½¬æ¢ä¸ºå›¾ç‰‡ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…å¯èƒ½éœ€è¦å…¶ä»–åº“ï¼‰"""
        # æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„å®ç°
        # å®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦ä½¿ç”¨ pdf2image æˆ–å…¶ä»–åº“æ¥è½¬æ¢
        # è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå ä½å›¾ç‰‡
        image = QImage(1080, 1440, QImage.Format_ARGB32)
        image.fill(Qt.white)
        
        painter = QPainter(image)
        painter.setPen(Qt.black)
        painter.drawText(100, 100, f"Exported: {Path(image_path).name}")
        painter.end()
        
        image.save(image_path, "PNG", 100)
    
    def handle_scroll(self, percentage: float):
        """å¤„ç†ç¼–è¾‘å™¨æ»šåŠ¨åŒæ­¥"""
        # é€šè¿‡JavaScriptåŒæ­¥æ»šåŠ¨
        script = f"""
        (function() {{
            var content = document.getElementById('content');
            if (content) {{
                content.scrollTop = content.scrollHeight * {percentage};
            }}
        }})();
        """
        self.web_view.page().runJavaScript(script)
```
 ç°åœ¨æˆ‘æ¥åˆ›å»ºä¸€ä¸ªæ›´å®Œå–„çš„æ™ºèƒ½åˆ†é¡µå™¨ï¼š ä»£ç 
```python
# ============================================
# src/utils/paginator.py
# ============================================
import re
from typing import List, Tuple
from dataclasses import dataclass

@dataclass
class PageElement:
    """é¡µé¢å…ƒç´ """
    type: str  # 'heading', 'paragraph', 'list', 'code', 'blockquote', 'table', 'hr'
    content: str
    level: int = 0  # æ ‡é¢˜çº§åˆ«æˆ–åµŒå¥—æ·±åº¦
    height: int = 0  # ä¼°ç®—é«˜åº¦ï¼ˆåƒç´ ï¼‰
    can_break: bool = True  # æ˜¯å¦å¯ä»¥åœ¨æ­¤å¤„åˆ†é¡µ
    
class SmartPaginator:
    """æ™ºèƒ½åˆ†é¡µå™¨"""
    
    # å…ƒç´ é«˜åº¦ä¼°ç®—ï¼ˆåƒç´ ï¼‰
    ELEMENT_HEIGHTS = {
        'h1': 80,
        'h2': 65,
        'h3': 55,
        'h4': 45,
        'paragraph': 30,  # åŸºç¡€é«˜åº¦ï¼Œæ¯è¡Œé¢å¤–å¢åŠ 
        'list_item': 35,
        'code_line': 25,
        'blockquote': 50,
        'table_row': 40,
        'hr': 30,
        'image': 300,
    }
    
    # é¡µé¢å‚æ•°
    PAGE_HEIGHT = 1440  # å°çº¢ä¹¦å¡ç‰‡é«˜åº¦
    PAGE_WIDTH = 1080   # å°çº¢ä¹¦å¡ç‰‡å®½åº¦
    PADDING_TOP = 45    # é¡¶éƒ¨å†…è¾¹è·
    PADDING_BOTTOM = 45 # åº•éƒ¨å†…è¾¹è·
    PADDING_SIDES = 40  # å·¦å³å†…è¾¹è·
    
    # æœ‰æ•ˆå†…å®¹é«˜åº¦
    CONTENT_HEIGHT = PAGE_HEIGHT - PADDING_TOP - PADDING_BOTTOM - 60  # å‡å»é¡µç åŒºåŸŸ
    
    # åˆ†é¡µç­–ç•¥å‚æ•°
    MIN_ORPHAN_LINES = 2  # å­¤è¡Œæ§åˆ¶ï¼šæ®µè½æœ«å°¾æœ€å°‘ä¿ç•™è¡Œæ•°
    MIN_WIDOW_LINES = 2   # å¯¡è¡Œæ§åˆ¶ï¼šæ®µè½å¼€å¤´æœ€å°‘ä¿ç•™è¡Œæ•°
    HEADING_KEEP_WITH = 100  # æ ‡é¢˜åè‡³å°‘ä¿ç•™çš„å†…å®¹é«˜åº¦
    
    def __init__(self):
        self.elements: List[PageElement] = []
        
    def parse_html_to_elements(self, html: str) -> List[PageElement]:
        """å°†HTMLè§£æä¸ºé¡µé¢å…ƒç´ åˆ—è¡¨"""
        elements = []
        
        # ç®€åŒ–çš„HTMLè§£æï¼ˆå®é™…é¡¹ç›®ä¸­åº”ä½¿ç”¨BeautifulSoupï¼‰
        # åŒ¹é…æ ‡é¢˜
        for match in re.finditer(r'<h([1-6])>(.*?)</h\1>', html, re.DOTALL):
            level = int(match.group(1))
            content = match.group(2)
            height = self.ELEMENT_HEIGHTS[f'h{level}']
            elements.append(PageElement(
                type='heading',
                content=f'<h{level}>{content}</h{level}>',
                level=level,
                height=height,
                can_break=False  # æ ‡é¢˜å‰ä¸åˆ†é¡µ
            ))
        
        # åŒ¹é…æ®µè½
        for match in re.finditer(r'<p>(.*?)</p>', html, re.DOTALL):
            content = match.group(0)
            # ä¼°ç®—æ®µè½é«˜åº¦ï¼ˆæ ¹æ®å­—ç¬¦æ•°ï¼‰
            char_count = len(re.sub(r'<[^>]+>', '', content))
            lines = max(1, char_count // 30)  # å‡è®¾æ¯è¡Œ30ä¸ªå­—ç¬¦
            height = self.ELEMENT_HEIGHTS['paragraph'] * lines
            elements.append(PageElement(
                type='paragraph',
                content=content,
                height=height,
                can_break=True
            ))
        
        # åŒ¹é…åˆ—è¡¨
        for match in re.finditer(r'<(ul|ol)>(.*?)</\1>', html, re.DOTALL):
            list_type = match.group(1)
            list_content = match.group(2)
            items = re.findall(r'<li>.*?</li>', list_content, re.DOTALL)
            height = len(items) * self.ELEMENT_HEIGHTS['list_item']
            elements.append(PageElement(
                type='list',
                content=match.group(0),
                height=height,
                can_break=len(items) > 3  # åˆ—è¡¨é¡¹å¤šäº3ä¸ªæ—¶å¯ä»¥åˆ†é¡µ
            ))
        
        # åŒ¹é…ä»£ç å—
        for match in re.finditer(r'<pre>(.*?)</pre>', html, re.DOTALL):
            content = match.group(0)
            lines = content.count('\n') + 1
            height = lines * self.ELEMENT_HEIGHTS['code_line'] + 40  # åŠ ä¸Šè¾¹è·
            elements.append(PageElement(
                type='code',
                content=content,
                height=height,
                can_break=False  # ä»£ç å—ä¸åˆ†é¡µ
            ))
        
        # åŒ¹é…å¼•ç”¨
        for match in re.finditer(r'<blockquote>(.*?)</blockquote>', html, re.DOTALL):
            content = match.group(0)
            height = self.ELEMENT_HEIGHTS['blockquote']
            elements.append(PageElement(
                type='blockquote',
                content=content,
                height=height,
                can_break=True
            ))
        
        # åŒ¹é…è¡¨æ ¼
        for match in re.finditer(r'<table>(.*?)</table>', html, re.DOTALL):
            content = match.group(0)
            rows = content.count('<tr>')
            height = rows * self.ELEMENT_HEIGHTS['table_row'] + 20
            elements.append(PageElement(
                type='table',
                content=content,
                height=height,
                can_break=rows > 5  # è¡¨æ ¼è¡Œæ•°å¤šäº5è¡Œæ—¶å¯ä»¥åˆ†é¡µ
            ))
        
        # åŒ¹é…åˆ†éš”çº¿
        for match in re.finditer(r'<hr\s*/?>',html):
            elements.append(PageElement(
                type='hr',
                content=match.group(0),
                height=self.ELEMENT_HEIGHTS['hr'],
                can_break=True
            ))
        
        return elements
    
    def paginate(self, html_content: str) -> List[str]:
        """æ‰§è¡Œæ™ºèƒ½åˆ†é¡µ"""
        # å¦‚æœå†…å®¹å¾ˆçŸ­ï¼Œç›´æ¥è¿”å›
        if len(html_content) < 1000:
            return [html_content]
        
        # è§£æHTMLä¸ºå…ƒç´ 
        elements = self.parse_html_to_elements(html_content)
        if not elements:
            return [html_content]
        
        pages = []
        current_page_elements = []
        current_height = 0
        
        for i, element in enumerate(elements):
            # æ£€æŸ¥æ˜¯å¦éœ€è¦æ–°é¡µé¢
            need_new_page = False
            
            # 1. é«˜åº¦æ£€æŸ¥
            if current_height + element.height > self.CONTENT_HEIGHT:
                need_new_page = True
            
            # 2. æ ‡é¢˜å…³è”æ£€æŸ¥
            if element.type == 'heading' and i < len(elements) - 1:
                next_element = elements[i + 1]
                # å¦‚æœæ ‡é¢˜åçš„å†…å®¹æ”¾ä¸ä¸‹ï¼ŒæŠŠæ ‡é¢˜ç§»åˆ°ä¸‹ä¸€é¡µ
                if current_height + element.height + next_element.height > self.CONTENT_HEIGHT:
                    need_new_page = True
            
            # 3. å­¤è¡Œå¯¡è¡Œæ§åˆ¶
            if element.type == 'paragraph':
                # å¦‚æœæ˜¯æ®µè½ä¸”å‰©ä½™ç©ºé—´å¾ˆå°‘ï¼Œç§»åˆ°ä¸‹ä¸€é¡µ
                remaining_height = self.CONTENT_HEIGHT - current_height
                if remaining_height < element.height * 0.3:  # å°‘äº30%çš„æ®µè½é«˜åº¦
                    need_new_page = True
            
            # åˆ›å»ºæ–°é¡µé¢
            if need_new_page and current_page_elements:
                page_html = ''.join([e.content for e in current_page_elements])
                pages.append(page_html)
                current_page_elements = []
                current_height = 0
            
            # æ·»åŠ å…ƒç´ åˆ°å½“å‰é¡µ
            current_page_elements.append(element)
            current_height += element.height
        
        # æ·»åŠ æœ€åä¸€é¡µ
        if current_page_elements:
            page_html = ''.join([e.content for e in current_page_elements])
            pages.append(page_html)
        
        return pages if pages else [html_content]
    
    def optimize_pages(self, pages: List[str]) -> List[str]:
        """ä¼˜åŒ–åˆ†é¡µç»“æœ"""
        optimized = []
        
        for i, page in enumerate(pages):
            # æ£€æŸ¥é¡µé¢æ˜¯å¦è¿‡ç©º
            if len(page.strip()) < 100 and i > 0:
                # å°è¯•ä¸å‰ä¸€é¡µåˆå¹¶
                if optimized:
                    optimized[-1] += page
                    continue
            
            optimized.append(page)
        
        return optimized
```
 æœ€åï¼Œè®©æˆ‘åˆ›å»ºä¸€ä¸ªæ”¹è¿›çš„å¯¼å‡ºå™¨ï¼Œä½¿ç”¨æ›´å¯é çš„æ–¹æ³•ï¼š ä»£ç 
```python
# ============================================
# src/utils/exporter.py
# ============================================
from PySide6.QtCore import QObject, Signal, QTimer, QEventLoop
from PySide6.QtGui import QImage, QPainter, QFont, QColor
from PySide6.QtWebEngineWidgets import QWebEngineView
from pathlib import Path
from typing import List, Optional
import json

class ImageExporter(QObject):
    """å›¾ç‰‡å¯¼å‡ºå™¨"""
    
    # ä¿¡å·
    progress = Signal(int, int)  # å½“å‰è¿›åº¦ï¼Œæ€»æ•°
    finished = Signal(bool, str)  # æ˜¯å¦æˆåŠŸï¼Œæ¶ˆæ¯
    
    def __init__(self, web_view: QWebEngineView):
        super().__init__()
        self.web_view = web_view
        self.pages_to_export = []
        self.current_export_index = 0
        self.output_folder = ""
        
    def export_pages(self, pages: List[str], output_folder: str, html_generator) -> None:
        """å¯¼å‡ºå¤šä¸ªé¡µé¢ä¸ºå›¾ç‰‡"""
        self.pages_to_export = pages
        self.output_folder = Path(output_folder)
        self.current_export_index = 0
        self.html_generator = html_generator
        
        # ç¡®ä¿è¾“å‡ºæ–‡ä»¶å¤¹
```

